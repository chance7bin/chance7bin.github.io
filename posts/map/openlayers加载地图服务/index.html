<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>openlayers加载地图服务 | Binb&#39;s Blog</title>
<meta name="keywords" content="地图, openlayers">
<meta name="description" content="1.加载在线WFS服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59">
<meta name="author" content="chance7bin">
<link rel="canonical" href="https://chance7bin.github.io/posts/map/openlayers%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.be81eec981a615a87a88f121642d7eebde74d033438693944db2fd6b827284ff.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity=""
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="apple-touch-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="mask-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="openlayers加载地图服务" />
<meta property="og:description" content="1.加载在线WFS服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chance7bin.github.io/posts/map/openlayers%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-08T22:37:33+08:00" />
<meta property="article:modified_time" content="2021-01-08T22:37:33+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="openlayers加载地图服务"/>
<meta name="twitter:description" content="1.加载在线WFS服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "📚 文章",
      "item": "https://chance7bin.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "🌏 地图专栏",
      "item": "https://chance7bin.github.io/posts/map/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "openlayers加载地图服务",
      "item": "https://chance7bin.github.io/posts/map/openlayers%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "openlayers加载地图服务",
  "name": "openlayers加载地图服务",
  "description": "1.加载在线WFS服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59",
  "keywords": [
    "地图", "openlayers"
  ],
  "articleBody": "1.加载在线WFS服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 \u003ctemplate\u003e \u003cview\u003e \u003cview id=\"map\" ref=\"rootmap\"\u003e\u003c/view\u003e \u003cview style=\"display: flex;\"\u003e \u003cbutton @click=\"moveView\"\u003emoveView\u003c/button\u003e \u003cbutton @click=\"fitToChengdu\"\u003efitToChengdu\u003c/button\u003e \u003c/view\u003e \u003c/view\u003e \u003c/template\u003e \u003cscript module=\"ol\" lang=\"renderjs\"\u003e import 'ol/ol.css'; import Map from 'ol/Map'; import View from 'ol/View'; import {Vector as VectorLayer,Tile as TileLayer} from 'ol/layer'; import {Vector as VectorSource,OSM,XYZ} from 'ol/source'; import {GeoJSON} from 'ol/format'; import {bbox} from 'ol/loadingstrategy' import {Style,Stroke,Circle,Fill} from 'ol/style'; import {fromLonLat} from 'ol/proj' var map = null export default { name: 'OlWFS', data() { return { }; }, onReady() { this.loadMap() }, methods:{ loadMap(){ //创建wfs资源 let wfsVectorSource = new VectorSource({ format: new GeoJSON(), projection: 'EPSG:4326', url: '/api/maptest/ows?service=WFS\u0026version=1.0.0\u0026request=GetFeature\u0026typeName=maptest%3Aqunaer_data_final\u0026maxFeatures=500\u0026outputFormat=application%2Fjson', strategy: bbox }); let wfsVectorSourcePolygon = new VectorSource({ format: new GeoJSON(), projection: 'EPSG:4326', url: '/api/maptest/ows?service=WFS\u0026version=1.0.0\u0026request=GetFeature\u0026typeName=maptest%3Achina_province\u0026maxFeatures=50\u0026outputFormat=application%2Fjson', strategy: bbox }); //创建wfs图层，注意需要设置好描边样式，否则不展示效果出来 let wfsVectorLayer = new VectorLayer({ source: wfsVectorSource, style: new Style({ image: new Circle({ radius: 5, fill: new Fill({ color: \"#3885ff\", opacity: 0.5 }) }), stroke: new Stroke({ color: 'blue', width: 5 }) }), visible: true }); //view设置 let view = new View({ // center: fromLonLat([105, 34],'EPSG:3857'), center: [105, 34], zoom: 5, maxZoom: 18, minZoom: 5, projection: 'EPSG:4326' });\t//创建一个map map = new Map({ layers: [ new TileLayer({ // source: new OSM() //这个会出现底图 source: new XYZ({ url: 'http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png' }) }), wfsVectorLayer ], target: \"map\", view: view }); map.on('click', function(evt) { console.log(\"evt:\",evt.pixel) // displayFeatureInfo(evt.pixel); var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) { return feature; }); console.log(\"feature:\",feature) if(feature != null){ console.log(\"feature getId:\",feature.getId()) console.log(\"feature getKeys:\",feature.getKeys()) console.log(\"feature getProperties:\",feature.getProperties()) } }); }, // 向左移动地图 moveView(){ var view = map.getView(); var mapCenter = view.getCenter(); // 让地图中心的x值增加，即可使得地图向左移动，增加的值根据效果可自由设定 console.log(\"mapCenter:\",mapCenter) mapCenter[0] += 50000; view.setCenter(mapCenter); map.render(); }, fitToChengdu() { // 让地图最大化完全地显示区域[104, 30.6, 104.12, 30.74] map.getView().fit([104, 30.6, 104.12, 30.74], map.getSize()); }, } }; \u003c/script\u003e \u003cstyle\u003e #map{ width: 100%; height: 90vh; } /*隐藏ol的一些自带元素*/ .ol-attribution, .ol-zoom { display: none; } \u003c/style\u003e 2.点击wfs要素展示数据 ==使用map.forEachFeatureAtPixel==\nhtml\n1 2 3 4 \u003cdiv id=\"popup\" class=\"ol-popup\"\u003e \u003ca href=\"#\" id=\"popup-closer\" class=\"ol-popup-closer\"\u003e\u003c/a\u003e \u003cdiv id=\"popup-content\"\u003e\u003c/div\u003e \u003c/div\u003e js\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 // 获取到popup的节点 var container = document.getElementById('popup'); var content = document.getElementById('popup-content'); var closer = document.getElementById('popup-closer'); /** * Add a click handler to hide the popup. * @return {boolean} Don't follow the href. */ closer.onclick = function () { overlay.setPosition(undefined); closer.blur(); return false; }; // 创建一个overlay, 绑定html元素container var overlay = new Overlay(/** @type {olx.OverlayOptions} */ ({ element: container, autoPan: true, autoPanAnimation: { duration: 250 } })); map.addOverlay(overlay) //点击要素获得信息 map.on('singleclick', function(evt) { // console.log(\"evt:\",evt) // displayFeatureInfo(evt.pixel); var feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) { return feature; }); console.log(\"feature:\",feature) if(feature != null){ // console.log(\"feature getId:\",feature.getId()) // console.log(\"feature getKeys:\",feature.getKeys()) // console.log(\"feature getProperties:\",feature.getProperties()) var prop = feature.getProperties(); if(feature.getId().indexOf(\"qunaer\") != -1){ content.innerHTML = '' + prop.F_name + '' + '地址:' + prop.address + '\n' + '",
  "wordCount" : "1692",
  "inLanguage": "zh",
  "datePublished": "2021-01-08T22:37:33+08:00",
  "dateModified": "2021-01-08T22:37:33+08:00",
  "author":[{
    "@type": "Person",
    "name": "chance7bin"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chance7bin.github.io/posts/map/openlayers%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Binb's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chance7bin.github.io/" accesskey="h" title="Binb&#39;s Blog (Alt + H)">
                <img src="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg" alt="" aria-label="logo"
                    height="35">Binb&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chance7bin.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/" title="🏠 主页">
                    <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/archives/" title="⏱️ 时间轴">
                    <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/posts" title="📚 文章">
                    <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/tags" title="🔖 标签">
                    <span>🔖 标签</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/chance7bin" title="GitHub">
                    <span>GitHub</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://chance7bin.github.io/">🏠 主页</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/">📚 文章</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/map/">🌏 地图专栏</a></div>
    <h1 class="post-title">
      openlayers加载地图服务
    </h1>
    <div class="post-meta">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">


<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2021-01-08
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>1692字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>4分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>chance7bin
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://chance7bin.github.io/tags/%E5%9C%B0%E5%9B%BE/" style="color: var(--secondary)!important;">地图</a>
                &nbsp;<a href="https://chance7bin.github.io/tags/openlayers/" style="color: var(--secondary)!important;">openlayers</a>
            </span>
        </span>
    </span>

    
</span>


      
      
      
      
      
      
      
          
          
          
              
              
              
              
          
      
    </div>
  </header>
   <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#1%e5%8a%a0%e8%bd%bd%e5%9c%a8%e7%ba%bfwfs%e6%9c%8d%e5%8a%a1" aria-label="1.加载在线WFS服务">1.加载在线WFS服务</a></li>
                    <li>
                        <a href="#2%e7%82%b9%e5%87%bbwfs%e8%a6%81%e7%b4%a0%e5%b1%95%e7%a4%ba%e6%95%b0%e6%8d%ae" aria-label="2.点击wfs要素展示数据">2.点击wfs要素展示数据</a></li>
                    <li>
                        <a href="#3%e9%80%9a%e8%bf%87wfs%e4%bf%ae%e6%94%b9%e6%95%b0%e6%8d%ae" aria-label="3.通过wfs修改数据">3.通过wfs修改数据</a></li>
                    <li>
                        <a href="#4%e5%8a%a0%e8%bd%bdwms-%e7%82%b9%e5%87%bbwms%e8%8e%b7%e5%be%97%e4%bf%a1%e6%81%af" aria-label="4.加载WMS 点击wms获得信息">4.加载WMS 点击wms获得信息</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h2 id="1加载在线wfs服务">1.加载在线WFS服务<a hidden class="anchor" aria-hidden="true" href="#1加载在线wfs服务">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">view</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">view</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;map&#34;</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">&#34;rootmap&#34;</span><span class="o">&gt;&lt;</span><span class="err">/view&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">view</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&#34;display: flex;&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">button</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;moveView&#34;</span><span class="o">&gt;</span><span class="nx">moveView</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">button</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;fitToChengdu&#34;</span><span class="o">&gt;</span><span class="nx">fitToChengdu</span><span class="o">&lt;</span><span class="err">/button&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/view&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/view&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">module</span><span class="o">=</span><span class="s2">&#34;ol&#34;</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&#34;renderjs&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="s1">&#39;ol/ol.css&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="nx">Map</span> <span class="nx">from</span> <span class="s1">&#39;ol/Map&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="nx">View</span> <span class="nx">from</span> <span class="s1">&#39;ol/View&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="p">{</span><span class="nx">Vector</span> <span class="nx">as</span> <span class="nx">VectorLayer</span><span class="p">,</span><span class="nx">Tile</span> <span class="nx">as</span> <span class="nx">TileLayer</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/layer&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="p">{</span><span class="nx">Vector</span> <span class="nx">as</span> <span class="nx">VectorSource</span><span class="p">,</span><span class="nx">OSM</span><span class="p">,</span><span class="nx">XYZ</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/source&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="p">{</span><span class="nx">GeoJSON</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/format&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="p">{</span><span class="nx">bbox</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/loadingstrategy&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="p">{</span><span class="nx">Style</span><span class="p">,</span><span class="nx">Stroke</span><span class="p">,</span><span class="nx">Circle</span><span class="p">,</span><span class="nx">Fill</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/style&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kr">import</span> <span class="p">{</span><span class="nx">fromLonLat</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol/proj&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;OlWFS&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">			<span class="p">};</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="nx">onReady</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="k">this</span><span class="p">.</span><span class="nx">loadMap</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="nx">methods</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="nx">loadMap</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">				<span class="c1">//创建wfs资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="kd">let</span> <span class="nx">wfsVectorSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VectorSource</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">					<span class="nx">format</span><span class="o">:</span> <span class="k">new</span> <span class="nx">GeoJSON</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">					<span class="nx">projection</span><span class="o">:</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/api/maptest/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=maptest%3Aqunaer_data_final&amp;maxFeatures=500&amp;outputFormat=application%2Fjson&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">strategy</span><span class="o">:</span> <span class="nx">bbox</span>
</span></span><span class="line"><span class="cl">				<span class="p">});</span>
</span></span><span class="line"><span class="cl">				<span class="kd">let</span> <span class="nx">wfsVectorSourcePolygon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VectorSource</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">					<span class="nx">format</span><span class="o">:</span> <span class="k">new</span> <span class="nx">GeoJSON</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">					<span class="nx">projection</span><span class="o">:</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/api/maptest/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=maptest%3Achina_province&amp;maxFeatures=50&amp;outputFormat=application%2Fjson&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">strategy</span><span class="o">:</span> <span class="nx">bbox</span>
</span></span><span class="line"><span class="cl">				<span class="p">});</span>
</span></span><span class="line"><span class="cl">				<span class="c1">//创建wfs图层，注意需要设置好描边样式，否则不展示效果出来
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="kd">let</span> <span class="nx">wfsVectorLayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VectorLayer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">					<span class="nx">source</span><span class="o">:</span> <span class="nx">wfsVectorSource</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">style</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Style</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">						<span class="nx">image</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Circle</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">							<span class="nx">radius</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">							<span class="nx">fill</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Fill</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">								<span class="nx">color</span><span class="o">:</span> <span class="s2">&#34;#3885ff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">								<span class="nx">opacity</span><span class="o">:</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">							<span class="p">})</span>
</span></span><span class="line"><span class="cl">						<span class="p">}),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">stroke</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Stroke</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">							<span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">							<span class="nx">width</span><span class="o">:</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">						<span class="p">})</span>
</span></span><span class="line"><span class="cl">					<span class="p">}),</span>
</span></span><span class="line"><span class="cl">					<span class="nx">visible</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">				<span class="p">});</span>
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">				<span class="c1">//view设置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="kd">let</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// center: fromLonLat([105, 34],&#39;EPSG:3857&#39;),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">105</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">					<span class="nx">zoom</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">minZoom</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">projection</span><span class="o">:</span> <span class="s1">&#39;EPSG:4326&#39;</span>
</span></span><span class="line"><span class="cl">				<span class="p">});</span>	
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">				<span class="c1">//创建一个map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">					<span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">						<span class="k">new</span> <span class="nx">TileLayer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">							<span class="c1">// source: new OSM() //这个会出现底图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>							<span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">XYZ</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">								<span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>
</span></span><span class="line"><span class="cl">							<span class="p">})</span>
</span></span><span class="line"><span class="cl">						<span class="p">}),</span>
</span></span><span class="line"><span class="cl">						<span class="nx">wfsVectorLayer</span>
</span></span><span class="line"><span class="cl">					<span class="p">],</span>
</span></span><span class="line"><span class="cl">					<span class="nx">target</span><span class="o">:</span> <span class="s2">&#34;map&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="nx">view</span><span class="o">:</span> <span class="nx">view</span>
</span></span><span class="line"><span class="cl">				<span class="p">});</span>
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">				<span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;evt:&#34;</span><span class="p">,</span><span class="nx">evt</span><span class="p">.</span><span class="nx">pixel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// displayFeatureInfo(evt.pixel);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">forEachFeatureAtPixel</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">pixel</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">return</span> <span class="nx">feature</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">});</span>
</span></span><span class="line"><span class="cl">					<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;feature:&#34;</span><span class="p">,</span><span class="nx">feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span><span class="p">(</span><span class="nx">feature</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">						<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;feature getId:&#34;</span><span class="p">,</span><span class="nx">feature</span><span class="p">.</span><span class="nx">getId</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">						<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;feature getKeys:&#34;</span><span class="p">,</span><span class="nx">feature</span><span class="p">.</span><span class="nx">getKeys</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">						<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;feature getProperties:&#34;</span><span class="p">,</span><span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">});</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="c1">// 向左移动地图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">moveView</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">				<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getView</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="kd">var</span> <span class="nx">mapCenter</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">getCenter</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// 让地图中心的x值增加，即可使得地图向左移动，增加的值根据效果可自由设定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;mapCenter:&#34;</span><span class="p">,</span><span class="nx">mapCenter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="nx">mapCenter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="nx">view</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">mapCenter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="nx">map</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="nx">fitToChengdu</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// 让地图最大化完全地显示区域[104, 30.6, 104.12, 30.74]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">map</span><span class="p">.</span><span class="nx">getView</span><span class="p">().</span><span class="nx">fit</span><span class="p">([</span><span class="mi">104</span><span class="p">,</span> <span class="mf">30.6</span><span class="p">,</span> <span class="mf">104.12</span><span class="p">,</span> <span class="mf">30.74</span><span class="p">],</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getSize</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="err">#</span><span class="nx">map</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">width</span><span class="o">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="nx">height</span><span class="o">:</span> <span class="mi">90</span><span class="nx">vh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="cm">/*隐藏ol的一些自带元素*/</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="nx">ol</span><span class="o">-</span><span class="nx">attribution</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="nx">ol</span><span class="o">-</span><span class="nx">zoom</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">display</span><span class="o">:</span> <span class="nx">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/style&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2点击wfs要素展示数据">2.点击wfs要素展示数据<a hidden class="anchor" aria-hidden="true" href="#2点击wfs要素展示数据">#</a></h2>
<p><strong>==使用map.forEachFeatureAtPixel==</strong></p>
<p>html</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;popup&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ol-popup&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;popup-closer&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;ol-popup-closer&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;popup-content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 获取到popup的节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;popup&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;popup-content&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">closer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;popup-closer&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Add a click handler to hide the popup.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @return {boolean} Don&#39;t follow the href.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">closer</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">overlay</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">closer</span><span class="p">.</span><span class="nx">blur</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 创建一个overlay, 绑定html元素container
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">overlay</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Overlay</span><span class="p">(</span><span class="cm">/** @type {olx.OverlayOptions} */</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">element</span><span class="o">:</span> <span class="nx">container</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">autoPan</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">autoPanAnimation</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">duration</span><span class="o">:</span> <span class="mi">250</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">map</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">overlay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//点击要素获得信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;singleclick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// console.log(&#34;evt:&#34;,evt)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// displayFeatureInfo(evt.pixel);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">forEachFeatureAtPixel</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">pixel</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">feature</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">});</span>
</span></span><span class="line"><span class="cl">	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;feature:&#34;</span><span class="p">,</span><span class="nx">feature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="nx">feature</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// console.log(&#34;feature getId:&#34;,feature.getId())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// console.log(&#34;feature getKeys:&#34;,feature.getKeys())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// console.log(&#34;feature getProperties:&#34;,feature.getProperties())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">getId</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;qunaer&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;&lt;h3&gt;&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">F_name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h3&gt;&#39;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;&lt;p style=&#34;margin:10px 0&#34;&gt;地址:&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">address</span> <span class="o">+</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;&lt;img src=&#34;&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">picurl</span> <span class="o">+</span> <span class="s1">&#39;&#34; height=&#34;150px&#34; /&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">getId</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;province&#34;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;&lt;h2&gt;&#39;</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">NL_NAME_1</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// 设置overlay的位置，从而显示在鼠标点击处
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">overlay</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">coordinate</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>css</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">ol-popup</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">background-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">4</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">padding</span><span class="p">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#cccccc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">bottom</span><span class="p">:</span> <span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">left</span><span class="p">:</span> <span class="mi">-50</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">min-width</span><span class="p">:</span> <span class="mi">250</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">ol-popup</span><span class="p">:</span><span class="nd">after</span><span class="o">,</span> <span class="p">.</span><span class="nc">ol-popup</span><span class="p">:</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">top</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">border</span><span class="p">:</span> <span class="kc">solid</span> <span class="kc">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">content</span><span class="p">:</span> <span class="s2">&#34; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">height</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pointer-events</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">ol-popup</span><span class="p">:</span><span class="nd">after</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">border-top-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">border-width</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">left</span><span class="p">:</span> <span class="mi">48</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">ol-popup</span><span class="p">:</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">border-top-color</span><span class="p">:</span> <span class="mh">#cccccc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">border-width</span><span class="p">:</span> <span class="mi">11</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">left</span><span class="p">:</span> <span class="mi">48</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-11</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">ol-popup-closer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">text-decoration</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">top</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">right</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">ol-popup-closer</span><span class="p">:</span><span class="nd">after</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">content</span><span class="p">:</span> <span class="s2">&#34;✖&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3通过wfs修改数据">3.通过wfs修改数据<a hidden class="anchor" aria-hidden="true" href="#3通过wfs修改数据">#</a></h2>
<p>加载wfs的时候要指定geometryName</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">wfsVectorLayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VectorLayer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">VectorSource</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">format</span><span class="o">:</span> <span class="k">new</span> <span class="nx">GeoJSON</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 因为数据源里面字段the_geom存储的是geometry，所以需要指定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">geometryName</span><span class="o">:</span> <span class="s1">&#39;the_geom&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/api/wfs?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=maptest%3Anyc_roads&amp;outputFormat=application%2Fjson&amp;srsname=EPSG:4326&#39;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">style</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">,</span> <span class="nx">resolution</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="nx">Style</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">stroke</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Stroke</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">width</span><span class="o">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 保存已经编辑的要素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">onSave</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">modifiedFeatures</span> <span class="o">&amp;&amp;</span> <span class="nx">modifiedFeatures</span><span class="p">.</span><span class="nx">getLength</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;modifiedFeatures:&#34;</span><span class="p">,</span><span class="nx">modifiedFeatures</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    	<span class="c1">// 转换坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="kd">var</span> <span class="nx">modifiedFeature</span> <span class="o">=</span> <span class="nx">modifiedFeatures</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">clone</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    	<span class="c1">// 注意ID是必须，通过ID才能找到对应修改的feature
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="nx">modifiedFeature</span><span class="p">.</span><span class="nx">setId</span><span class="p">(</span><span class="nx">modifiedFeatures</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">getId</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    	<span class="c1">// 调换经纬度坐标，以符合wfs协议中经纬度的位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="nx">modifiedFeature</span><span class="p">.</span><span class="nx">getGeometry</span><span class="p">().</span><span class="nx">applyTransform</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">flatCoordinates</span><span class="p">,</span> <span class="nx">flatCoordinates2</span><span class="p">,</span> <span class="nx">stride</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">flatCoordinates</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">+=</span> <span class="nx">stride</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">flatCoordinates</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">flatCoordinates</span><span class="p">[</span><span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nx">flatCoordinates</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nx">flatCoordinates</span><span class="p">[</span><span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    	<span class="p">});</span>
</span></span><span class="line"><span class="cl">    	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;modifyWfs:&#34;</span><span class="p">,</span><span class="nx">modifiedFeature</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    	<span class="k">this</span><span class="p">.</span><span class="nx">modifyWfs</span><span class="p">([</span><span class="nx">modifiedFeature</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 把修改提交到服务器端
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">modifyWfs</span><span class="p">(</span><span class="nx">features</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">WFSTSerializer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WFS</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">featObject</span> <span class="o">=</span> <span class="nx">WFSTSerializer</span><span class="p">.</span><span class="nx">writeTransaction</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    	<span class="nx">features</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">featureType</span><span class="o">:</span> <span class="s1">&#39;nyc_roads&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="c1">// 注意这个值必须为创建工作区时的命名空间URI   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">featureNS</span><span class="o">:</span> <span class="s1">&#39;http://maptest/test1&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">                <span class="nx">srsName</span><span class="o">:</span> <span class="s1">&#39;EPSG:4326&#39;</span>
</span></span><span class="line"><span class="cl">    	<span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 转换为xml内容发送到服务器端
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">serializer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLSerializer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">featString</span> <span class="o">=</span> <span class="nx">serializer</span><span class="p">.</span><span class="nx">serializeToString</span><span class="p">(</span><span class="nx">featObject</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;featString:&#34;</span><span class="p">,</span><span class="nx">featString</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uni</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/api/wfs?service=WFS&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">data</span><span class="o">:</span><span class="nx">featString</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">header</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 指定内容为xml类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/xml&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">success</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;success res:&#34;</span><span class="p">,</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4加载wms-点击wms获得信息">4.加载WMS 点击wms获得信息<a hidden class="anchor" aria-hidden="true" href="#4加载wms-点击wms获得信息">#</a></h2>
<p>使用**==getFeatureInfoUrl==**</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">//加载WMS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">wmsLayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TileLayer</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">TileWMS</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span><span class="o">:</span> <span class="s2">&#34;/api/maptest/wms&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">params</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">wmsSource</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;TILED&#39;</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">transition</span><span class="o">:</span> <span class="mi">0</span>  <span class="c1">//渲染时不透明度过渡的持续时间。要禁用不透明度转换 transition: 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="nx">projection</span><span class="o">:</span> <span class="s2">&#34;EPSG:4326&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// center: [105, 34],
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">118.006954</span><span class="p">,</span><span class="mf">25.101685</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	<span class="nx">zoom</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">minZoom</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// layers: [tileOSM, tileLayer],
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">layers</span><span class="o">:</span> <span class="p">[</span><span class="nx">tileOSM</span><span class="p">,</span> <span class="nx">wmsLayer</span><span class="p">,</span> <span class="nx">wfsVectorLayer</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	<span class="nx">view</span><span class="o">:</span> <span class="nx">view</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//点击wms获得信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;singleclick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// document.getElementById(&#39;nodelist&#39;).innerHTML = &#34;Loading... please wait...&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">map</span><span class="p">.</span><span class="nx">getView</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">viewResolution</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">getResolution</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">wmsLayer</span><span class="p">.</span><span class="nx">getSource</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">getFeatureInfoUrl</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">evt</span><span class="p">.</span><span class="nx">coordinate</span><span class="p">,</span> <span class="nx">viewResolution</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">getProjection</span><span class="p">(),</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;INFO_FORMAT&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;FEATURE_COUNT&#39;</span><span class="o">:</span> <span class="mi">50</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// document.getElementById(&#39;nodelist&#39;).innerHTML = &#39;&lt;iframe seamless src=&#34;&#39; + url + &#39;&#34;&gt;&lt;/iframe&gt;&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;url:&#34;</span><span class="p">,</span><span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://chance7bin.github.io/posts/map/openlayers-uniapp-%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/">
    <span class="title">« 上一页</span>
    <br>
    <span>openlayers uniapp 移动端开发问题汇总</span>
  </a>
  <a class="next" href="https://chance7bin.github.io/posts/map/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">
    <span class="title">下一页 »</span>
    <br>
    <span>参考资料</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://chance7bin.github.io/">Binb&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
