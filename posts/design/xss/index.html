<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>xss | Binb&#39;s Blog</title>
<meta name="keywords" content="ç³»ç»Ÿè®¾è®¡, å®‰å…¨">
<meta name="description" content="XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºX">
<meta name="author" content="chance7bin">
<link rel="canonical" href="https://chance7bin.github.io/posts/design/xss/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.be81eec981a615a87a88f121642d7eebde74d033438693944db2fd6b827284ff.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity=""
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="apple-touch-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="mask-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="xss" />
<meta property="og:description" content="XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºX" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chance7bin.github.io/posts/design/xss/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-14T22:37:33+08:00" />
<meta property="article:modified_time" content="2023-06-14T22:37:33+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="xss"/>
<meta name="twitter:description" content="XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºX"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“š æ–‡ç« ",
      "item": "https://chance7bin.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ¨ ç³»ç»Ÿè®¾è®¡",
      "item": "https://chance7bin.github.io/posts/design/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "xss",
      "item": "https://chance7bin.github.io/posts/design/xss/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "xss",
  "name": "xss",
  "description": "XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºX",
  "keywords": [
    "ç³»ç»Ÿè®¾è®¡", "å®‰å…¨"
  ],
  "articleBody": " XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚\nXSS ç®€ä»‹ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå°±æ˜¯ç•™è¨€æ¿ã€‚æˆ‘ä»¬çŸ¥é“ç•™è¨€æ¿é€šå¸¸çš„ä»»åŠ¡å°±æ˜¯æŠŠç”¨æˆ·ç•™è¨€çš„å†…å®¹å±•ç¤ºå‡ºæ¥ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„ç•™è¨€éƒ½æ˜¯æ­£å¸¸çš„è¯­è¨€æ–‡å­—ï¼Œç•™è¨€æ¿æ˜¾ç¤ºçš„å†…å®¹ä¹Ÿå°±æ²¡æ¯›ç—…ã€‚ç„¶è€Œè¿™ä¸ªæ—¶å€™å¦‚æœæœ‰äººä¸æŒ‰å¥—è·¯å‡ºç‰Œï¼Œåœ¨ç•™è¨€å†…å®¹ä¸­ä¸¢è¿›å»ä¸€è¡Œ\n1 \u003cscript\u003ealert(\"aaa\")\u003c/script\u003e é‚£ä¹ˆç•™è¨€æ¿ç•Œé¢çš„ç½‘é¡µä»£ç å°±ä¼šå˜æˆå½¢å¦‚ä»¥ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eBoard\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"board\"\u003e \u003cscript\u003ealert(\"aaa\")\u003c/script\u003e \u003c/div\u003e \u003c/body\u003e \u003c/html\u003e é‚£ä¹ˆè¿™ä¸ªæ—¶å€™é—®é¢˜å°±æ¥äº†ï¼Œå½“æµè§ˆå™¨è§£æåˆ°ç”¨æˆ·è¾“å…¥çš„ä»£ç é‚£ä¸€è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆå¾ˆæ˜¾ç„¶ï¼Œæµè§ˆå™¨å¹¶ä¸çŸ¥é“è¿™äº›ä»£ç æ”¹å˜äº†åŸæœ¬ç¨‹åºçš„æ„å›¾ï¼Œä¼šç…§åšå¼¹å‡ºä¸€ä¸ªä¿¡æ¯æ¡†ã€‚\næ—¢ç„¶èƒ½å¤Ÿæ‰§è¡Œè„šæœ¬ï¼Œé‚£ä¹ˆï¼Œè¿™äº›è„šæœ¬å®Œå…¨å¯ä»¥æ˜¯ï¼š\né“¾æ¥åŠ«æŒ 1 \u003cscript\u003ewindow.location.href=\"http://www.baidu.com\";\u003c/script\u003e ç›—å–cookie 1 \u003cscript\u003ealert(\"document.cookie\");\u003c/script\u003e å¯¹äºæ”»å‡»è€…æ¥è¯´ï¼Œèƒ½å¤Ÿè®©å—å®³è€…æµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç çš„å”¯ä¸€æ–¹å¼ï¼Œå°±æ˜¯æŠŠä»£ç æ³¨å…¥åˆ°å—å®³è€…ä»ç½‘ç«™ä¸‹è½½çš„ç½‘é¡µä¸­, è¿™å°±æ˜¯xssæ”»å‡»ã€‚\nXSS æ”»å‡»ç±»å‹ é€šå¸¸XSSæ”»å‡»åˆ†ä¸ºï¼šåå°„å‹xssæ”»å‡», å­˜å‚¨å‹xssæ”»å‡» å’Œ DOMå‹xssæ”»å‡»ã€‚åŒæ—¶æ³¨æ„ä»¥ä¸‹ä¾‹å­åªæ˜¯ç®€å•çš„å‘ä½ è§£é‡Šè¿™ä¸‰ç§ç±»å‹çš„æ”»å‡»æ–¹å¼è€Œå·²ï¼Œå®é™…æƒ…å†µæ¯”è¿™ä¸ªå¤æ‚ï¼Œå…·ä½“å¯ä»¥å†ç»“åˆæœ€åä¸€èŠ‚æ·±å…¥ç†è§£ã€‚\nåå°„å‹xssæ”»å‡» åå°„å‹çš„æ”»å‡»éœ€è¦ç”¨æˆ·ä¸»åŠ¨çš„å»è®¿é—®å¸¦æ”»å‡»çš„é“¾æ¥ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡é‚®ä»¶æˆ–è€…çŸ­ä¿¡çš„å½¢å¼ï¼Œè¯±å¯¼å—å®³è€…ç‚¹å¼€é“¾æ¥ã€‚å¦‚æœæ”»å‡»è€…é…åˆçŸ­é“¾æ¥URLï¼Œæ”»å‡»æˆåŠŸçš„æ¦‚ç‡ä¼šæ›´é«˜ã€‚\nåœ¨ä¸€ä¸ªåå°„å‹XSSæ”»å‡»ä¸­ï¼Œæ¶æ„æ–‡æœ¬å±äºå—å®³è€…å‘é€ç»™ç½‘ç«™çš„è¯·æ±‚ä¸­çš„ä¸€éƒ¨åˆ†ã€‚éšåç½‘ç«™åˆæŠŠæ¶æ„æ–‡æœ¬åŒ…å«è¿›ç”¨äºå“åº”ç”¨æˆ·çš„è¿”å›é¡µé¢ä¸­ï¼Œå‘è¿˜ç»™ç”¨æˆ·ã€‚\n1ã€ç”¨æˆ·è¯¯ç‚¹å¼€äº†å¸¦æ”»å‡»çš„url : http://xxx?name=\n2ã€ç½‘ç«™ç»™å—å®³è€…çš„è¿”å›ä¸­æ­£å¸¸çš„ç½‘é¡µ\n3ã€ç”¨æˆ·çš„æµè§ˆå™¨æ”¶åˆ°æ–‡æœ¬åæ‰§è¡Œé¡µé¢åˆæ³•è„šæœ¬ï¼Œè¿™æ—¶å€™é¡µé¢æ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä¼šåœ¨ç½‘é¡µä¸­å¼¹çª—aaa\nè¿™ç§æ”»å‡»æ–¹å¼å‘ç”Ÿåœ¨æˆ‘ä»¬åˆæ³•çš„jsæ‰§è¡Œä¸­ï¼ŒæœåŠ¡å™¨æ— æ³•æ£€æµ‹æˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦æœ‰æ”»å‡»çš„å±é™©\nå­˜å‚¨å‹xssæ”»å‡» è¿™ç§æ”»å‡»æ–¹å¼æ¶æ„ä»£ç ä¼šè¢«å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–ç”¨æˆ·åœ¨æ­£å¸¸è®¿é—®çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæœ‰ä¼šè¢«æ”»å‡»ï¼Œå½±å“çš„èŒƒå›´æ¯”è¾ƒå¤§ã€‚\n1ã€æ”»å‡»è€…é€šè¿‡è¯„è®ºè¡¨å•æäº¤å°†æäº¤åˆ°ç½‘ç«™\n2ã€ç½‘ç«™åç«¯å¯¹æäº¤çš„è¯„è®ºæ•°æ®ä¸åšä»»ä½•æ“ä½œï¼Œç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“ä¸­\n3ã€å…¶ä»–ç”¨æˆ·è®¿é—®æ­£å¸¸è®¿é—®ç½‘ç«™ï¼Œå¹¶ä¸”éœ€è¦è¯·æ±‚ç½‘ç«™çš„è¯„è®ºæ•°æ®\n4ã€ç½‘ç«™åç«¯ä¼šä»æ•°æ®åº“ä¸­å–å‡ºæ•°æ®ï¼Œç›´æ¥è¿”å›ç»™ç”¨æˆ·\n5ã€ç”¨æˆ·å¾—åˆ°é¡µé¢åï¼Œç›´æ¥è¿è¡Œæ”»å‡»è€…æäº¤çš„ä»£ç ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šåœ¨ç½‘é¡µä¸­å¼¹å‡ºaaaçš„å¼¹çª—\nDOMå‹xssæ”»å‡» åŸºäºDOMçš„XSSæ”»å‡»æ˜¯åå°„å‹æ”»å‡»çš„å˜ç§ã€‚æœåŠ¡å™¨è¿”å›çš„é¡µé¢æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯æˆ‘ä»¬åœ¨é¡µé¢æ‰§è¡Œjsçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠæ”»å‡»ä»£ç æ¤å…¥åˆ°é¡µé¢ä¸­ã€‚\n1ã€ç”¨æˆ·è¯¯ç‚¹å¼€äº†å¸¦æ”»å‡»çš„url : http://xxx?name=\n2ã€ç½‘ç«™ç»™å—å®³è€…çš„è¿”å›ä¸­æ­£å¸¸çš„ç½‘é¡µ\n3ã€ç”¨æˆ·çš„æµè§ˆå™¨æ”¶åˆ°æ–‡æœ¬åæ‰§è¡Œé¡µé¢åˆæ³•è„šæœ¬ï¼Œè¿™æ—¶å€™é¡µé¢æ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä¼šåœ¨ç½‘é¡µä¸­å¼¹çª—aaa\nè¿™ç§æ”»å‡»æ–¹å¼å‘ç”Ÿåœ¨æˆ‘ä»¬åˆæ³•çš„jsæ‰§è¡Œä¸­ï¼ŒæœåŠ¡å™¨æ— æ³•æ£€æµ‹æˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦æœ‰æ”»å‡»çš„å±é™©\nXSS æ”»å‡»çš„å±å®³ é€šè¿‡document.cookieç›—å–cookie ä½¿ç”¨jsæˆ–cssç ´åé¡µé¢æ­£å¸¸çš„ç»“æ„ä¸æ ·å¼ æµé‡åŠ«æŒï¼ˆé€šè¿‡è®¿é—®æŸæ®µå…·æœ‰window.location.hrefå®šä½åˆ°å…¶ä»–é¡µé¢ï¼‰ Dosæ”»å‡»ï¼šåˆ©ç”¨åˆç†çš„å®¢æˆ·ç«¯è¯·æ±‚æ¥å ç”¨è¿‡å¤šçš„æœåŠ¡å™¨èµ„æºï¼Œä»è€Œä½¿åˆæ³•ç”¨æˆ·æ— æ³•å¾—åˆ°æœåŠ¡å™¨å“åº”ã€‚ åˆ©ç”¨iframeã€frameã€XMLHttpRequestæˆ–ä¸Šè¿°Flashç­‰æ–¹å¼ï¼Œä»¥ï¼ˆè¢«æ”»å‡»ï¼‰ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œä¸€äº›ç®¡ç†åŠ¨ä½œï¼Œæˆ–æ‰§è¡Œä¸€äº›ä¸€èˆ¬çš„å¦‚å‘å¾®åšã€åŠ å¥½å‹ã€å‘ç§ä¿¡ç­‰æ“ä½œã€‚ åˆ©ç”¨å¯è¢«æ”»å‡»çš„åŸŸå—åˆ°å…¶ä»–åŸŸä¿¡ä»»çš„ç‰¹ç‚¹ï¼Œä»¥å—ä¿¡ä»»æ¥æºçš„èº«ä»½è¯·æ±‚ä¸€äº›å¹³æ—¶ä¸å…è®¸çš„æ“ä½œï¼Œå¦‚è¿›è¡Œä¸å½“çš„æŠ•ç¥¨æ´»åŠ¨ã€‚ DOSï¼ˆæ‹’ç»æœåŠ¡ï¼‰å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚ é’“é±¼æ”»å‡»ï¼Œé«˜çº§çš„é’“é±¼æŠ€å·§ã€‚ åŠ«æŒç”¨æˆ·Webè¡Œä¸ºï¼Œç”šè‡³è¿›ä¸€æ­¥æ¸—é€å†…ç½‘ã€‚ è •è™«å¼æŒ‚é©¬æ”»å‡»ã€åˆ·å¹¿å‘Šã€åˆ·æµé‡ã€ç ´åç½‘ä¸Šæ•°æ® é€šè¿‡xssç›—ç”¨cookieå±å®³æ˜¯ä»€ä¹ˆï¼Ÿ csrfæ”»å‡»å…¶å®æ˜¯ä¸èƒ½ç›—ç”¨cookieçš„ï¼Œå®ƒåªæ˜¯ä»¥å½“å‰çš„åä¹‰è¿›è¡Œæ¶æ„æ“ä½œï¼›è€Œxssæ”»å‡»æ˜¯å¯ä»¥ç›´æ¥ç›—ç”¨cookieã€‚\né‚£ç›—ç”¨cookieçš„å±å®³æ˜¯ä»€ä¹ˆï¼Ÿæ¯”å¦‚æ‹¿åˆ°ç”¨æˆ·çš„cookieä¿¡æ¯ï¼Œç„¶åä¼ é€åˆ°æ”»å‡»è€…è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä»cookieä¸­æå–æ•æ„Ÿä¿¡æ¯ï¼Œæ‹¿åˆ°ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œæˆ–è€…æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹DOMåœ¨é¡µé¢ä¸Šæ’å…¥ä¸€ä¸ªå‡çš„ç™»é™†æ¡†ï¼Œä¹Ÿå¯ä»¥æŠŠè¡¨å•çš„actionå±æ€§æŒ‡å‘ä»–è‡ªå·±çš„æœåŠ¡å™¨åœ°å€ï¼Œç„¶åæ¬ºéª—ç”¨æˆ·æäº¤è‡ªå·±çš„æ•æ„Ÿä¿¡æ¯ã€‚\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆcookieä¹Ÿæ˜¯è¦é˜²å¾¡çš„\nXSS æ”»å‡»çš„é˜²å¾¡ XSSæ”»å‡»å…¶å®å°±æ˜¯ä»£ç çš„æ³¨å…¥ã€‚ç”¨æˆ·çš„è¾“å…¥è¢«ç¼–è¯‘æˆæ¶æ„çš„ç¨‹åºä»£ç ã€‚æ‰€ä»¥ï¼Œä¸ºäº†é˜²èŒƒè¿™ä¸€ç±»ä»£ç çš„æ³¨å…¥ï¼Œéœ€è¦ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„å®‰å…¨æ€§ã€‚å¯¹äºæ”»å‡»éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æªæ–½ï¼š\nç¼–ç ï¼Œå°±æ˜¯è½¬ä¹‰ç”¨æˆ·çš„è¾“å…¥ï¼ŒæŠŠç”¨æˆ·çš„è¾“å…¥è§£è¯»ä¸ºæ•°æ®è€Œä¸æ˜¯ä»£ç  æ ¡éªŒï¼Œå¯¹ç”¨æˆ·çš„è¾“å…¥åŠè¯·æ±‚éƒ½è¿›è¡Œè¿‡æ»¤æ£€æŸ¥ï¼Œå¦‚å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œè®¾ç½®è¾“å…¥åŸŸçš„åŒ¹é…è§„åˆ™ç­‰ã€‚ å…·ä½“æ¯”å¦‚ï¼š\nå¯¹äºéªŒè¯è¾“å…¥ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åœ¨æœåŠ¡ç«¯éªŒè¯ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯éªŒè¯ å¯¹äºæŒä¹…æ€§å’Œåå°„å‹æ”»å‡»ï¼ŒæœåŠ¡ç«¯éªŒè¯æ˜¯å¿…é¡»çš„ï¼ŒæœåŠ¡ç«¯æ”¯æŒçš„ä»»ä½•è¯­è¨€éƒ½èƒ½å¤Ÿåšåˆ° å¯¹äºåŸºäºDOMçš„XSSæ”»å‡»ï¼ŒéªŒè¯è¾“å…¥åœ¨å®¢æˆ·ç«¯å¿…é¡»æ‰§è¡Œï¼Œå› ä¸ºä»æœåŠ¡ç«¯æ¥è¯´ï¼Œæ‰€æœ‰å‘å‡ºçš„é¡µé¢å†…å®¹æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯åœ¨å®¢æˆ·ç«¯jsä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ‰å‘ç”Ÿå¯æ”»å‡» ä½†æ˜¯å¯¹äºå„ç§æ”»å‡»æ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¥½åšåˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½è¿›è¡Œå¤„ç†ã€‚ å…¶å®ƒè¿˜æœ‰ä¸€äº›è¾…åŠ©æªæ–½ï¼Œæ¯”å¦‚ï¼š\nå…¥å‚é•¿åº¦é™åˆ¶ï¼š é€šè¿‡ä»¥ä¸Šçš„æ¡ˆä¾‹æˆ‘ä»¬ä¸éš¾å‘ç°xssæ”»å‡»è¦èƒ½è¾¾æˆå¾€å¾€éœ€è¦è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤å¯¹äºä¸€äº›å¯ä»¥é¢„æœŸçš„è¾“å…¥å¯ä»¥é€šè¿‡é™åˆ¶é•¿åº¦å¼ºåˆ¶æˆªæ–­æ¥è¿›è¡Œé˜²å¾¡ã€‚ è®¾ç½®cookie http-onlyä¸ºtrue éªŒè¯è¾“å…¥ è‡ªå®šä¹‰@Xssæ³¨è§£ï¼Œå°†å®šä¹‰çš„Xssæ³¨è§£æ”¾åœ¨å­—æ®µæˆ–è€…æ–¹æ³•çš„ä¸Šæ–¹\n@Xssæ³¨è§£\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /** * è‡ªå®šä¹‰xssæ ¡éªŒæ³¨è§£ * * @author 7bin */ @Retention(RetentionPolicy.RUNTIME) @Target(value = { ElementType.METHOD, ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.PARAMETER }) @Constraint(validatedBy = { XssValidator.class }) public @interface Xss { String message() default \"ä¸å…è®¸ä»»ä½•è„šæœ¬è¿è¡Œ\"; Class\u003c?\u003e[] groups() default {}; Class\u003c? extends Payload\u003e[] payload() default {}; } è‡ªå®šä¹‰æ ¡éªŒå™¨XssValidator\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 /** * è‡ªå®šä¹‰xssæ ¡éªŒæ³¨è§£å®ç° * * @author 7bin */ public class XssValidator implements ConstraintValidator\u003cXss, String\u003e { private static final String HTML_PATTERN = \"\u003c(\\\\S*?)[^\u003e]*\u003e.*?|\u003c.*? /\u003e\"; @Override public boolean isValid(String value, ConstraintValidatorContext constraintValidatorContext) { if (StringUtils.isBlank(value)) { return true; } return !containsHtml(value); } public static boolean containsHtml(String value) { Pattern pattern = Pattern.compile(HTML_PATTERN); Matcher matcher = pattern.matcher(value); return matcher.matches(); } } ä½¿ç”¨è‡ªå®šä¹‰Xssæ³¨è§£\nå®ä½“ç±»\n1 2 3 4 5 6 7 8 9 10 public class SysUser extends BaseEntity { .... @Xss(message = \"ç”¨æˆ·è´¦å·ä¸èƒ½åŒ…å«è„šæœ¬å­—ç¬¦\") @NotBlank(message = \"ç”¨æˆ·è´¦å·ä¸èƒ½ä¸ºç©º\") @Size(min = 0, max = 30, message = \"ç”¨æˆ·è´¦å·é•¿åº¦ä¸èƒ½è¶…è¿‡30ä¸ªå­—ç¬¦\") public String getUserName() { return userName; } } Controller\nåœ¨Controllerçš„æ–¹æ³•ä¸Šï¼Œç»™å‚æ•°SysUserç±»åŠ ä¸Š@Validatedæ¥ä¿®é¥°ï¼Œè¿™æ ·æ ¡éªŒå°±å¯ä»¥ç”Ÿæ•ˆäº†\n1 2 3 4 5 @PutMapping public ApiResponse edit(@Validated @RequestBody SysUser user) { ... } escapeHTML åœ¨æœåŠ¡ç«¯æ·»åŠ XSSçš„Filterï¼Œç”¨äºæ­£ç¡®å¤„ç†è½¬ä¹‰å­—ç¬¦ï¼Œäº§ç”Ÿæ­£ç¡®çš„Javaã€JavaScriptã€HTMLã€XMLå’ŒSQLä»£ç \nFilterConfigï¼šæ³¨å†ŒXSSè¿‡æ»¤å™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 @Configuration public class FilterConfig { @Value(\"${xss.excludes}\") private String excludes; @Value(\"${xss.urlPatterns}\") private String urlPatterns; @SuppressWarnings({ \"rawtypes\", \"unchecked\" }) @Bean @ConditionalOnProperty(value = \"xss.enabled\", havingValue = \"true\") public FilterRegistrationBean xssFilterRegistration() { FilterRegistrationBean registration = new FilterRegistrationBean(); registration.setDispatcherTypes(DispatcherType.REQUEST); registration.setFilter(new XssFilter()); registration.addUrlPatterns(StringUtils.split(urlPatterns, \",\")); registration.setName(\"xssFilter\"); registration.setOrder(FilterRegistrationBean.HIGHEST_PRECEDENCE); Map\u003cString, String\u003e initParameters = new HashMap\u003cString, String\u003e(); initParameters.put(\"excludes\", excludes); registration.setInitParameters(initParameters); return registration; } } XssFilterï¼šä½¿ç”¨è‡ªå®šä¹‰XssHttpServletRequestWrapperæ›¿æ¢é»˜è®¤çš„request\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 /** * é˜²æ­¢XSSæ”»å‡»çš„è¿‡æ»¤å™¨ * * @author 7bin */ public class XssFilter implements Filter { /** * æ’é™¤é“¾æ¥ */ public List\u003cString\u003e excludes = new ArrayList\u003c\u003e(); @Override public void init(FilterConfig filterConfig) throws ServletException { String tempExcludes = filterConfig.getInitParameter(\"excludes\"); if (StringUtils.isNotEmpty(tempExcludes)) { String[] url = tempExcludes.split(\",\"); for (int i = 0; url != null \u0026\u0026 i \u003c url.length; i++) { excludes.add(url[i]); } } } @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { HttpServletRequest req = (HttpServletRequest) request; HttpServletResponse resp = (HttpServletResponse) response; if (handleExcludeURL(req, resp)) { chain.doFilter(request, response); return; } XssHttpServletRequestWrapper xssRequest = new XssHttpServletRequestWrapper((HttpServletRequest) request); chain.doFilter(xssRequest, response); } private boolean handleExcludeURL(HttpServletRequest request, HttpServletResponse response) { String url = request.getServletPath(); String method = request.getMethod(); // GET DELETE ä¸è¿‡æ»¤ if (method == null || HttpMethod.GET.matches(method) || HttpMethod.DELETE.matches(method)) { return true; } return StringUtils.matches(url, excludes); } @Override public void destroy() { } } XssHttpServletRequestWrapper\nxssè¿‡æ»¤ï¼ˆæ¸…é™¤æ‰€æœ‰HTMLæ ‡ç­¾ï¼Œä½†æ˜¯ä¸åˆ é™¤æ ‡ç­¾å†…çš„å†…å®¹ï¼‰ï¼šjson = EscapeUtil.clean(json).trim();\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 /** * XSSè¿‡æ»¤å¤„ç† * * @author 7bin */ public class XssHttpServletRequestWrapper extends HttpServletRequestWrapper { /** * @param request */ public XssHttpServletRequestWrapper(HttpServletRequest request) { super(request); } @Override public String[] getParameterValues(String name) { String[] values = super.getParameterValues(name); if (values != null) { int length = values.length; String[] escapesValues = new String[length]; for (int i = 0; i \u003c length; i++) { // é˜²xssæ”»å‡»å’Œè¿‡æ»¤å‰åç©ºæ ¼ escapesValues[i] = EscapeUtil.clean(values[i]).trim(); } return escapesValues; } return super.getParameterValues(name); } @Override public ServletInputStream getInputStream() throws IOException { // éjsonç±»å‹ï¼Œç›´æ¥è¿”å› if (!isJsonRequest()) { return super.getInputStream(); } // ä¸ºç©ºï¼Œç›´æ¥è¿”å› String json = IOUtils.toString(super.getInputStream(), \"utf-8\"); if (StringUtils.isEmpty(json)) { return super.getInputStream(); } // xssè¿‡æ»¤ json = EscapeUtil.clean(json).trim(); byte[] jsonBytes = json.getBytes(\"utf-8\"); final ByteArrayInputStream bis = new ByteArrayInputStream(jsonBytes); return new ServletInputStream() { @Override public boolean isFinished() { return true; } @Override public boolean isReady() { return true; } @Override public int available() throws IOException { return jsonBytes.length; } @Override public void setReadListener(ReadListener readListener) { } @Override public int read() throws IOException { return bis.read(); } }; } /** * æ˜¯å¦æ˜¯Jsonè¯·æ±‚ * */ public boolean isJsonRequest() { String header = super.getHeader(HttpHeaders.CONTENT_TYPE); return StringUtils.startsWithIgnoreCase(header, MediaType.APPLICATION_JSON_VALUE); } } http-only å¦‚æœæŸä¸€ä¸ªCookie é€‰é¡¹è¢«è®¾ç½®æˆ HttpOnly = true çš„è¯ï¼Œé‚£æ­¤Cookie åªèƒ½é€šè¿‡æœåŠ¡å™¨ç«¯ä¿®æ”¹ï¼ŒJS æ˜¯æ“ä½œä¸äº†çš„ï¼Œå¯¹äº document.cookie æ¥è¯´æ˜¯é€æ˜çš„ã€‚\nhttp-only çš„åº”ç”¨åœºæ™¯æ˜¯é˜²æ­¢ XSS æ”»å‡»ã€‚\nä¸¾ä¾‹ï¼š\nä¾‹å¦‚æˆ‘åœ¨è¯„è®ºåŒºå†™äº†ä¸€æ®µ hack JSï¼ŒæœåŠ¡ç«¯å› å­˜åœ¨ XSS æ¼æ´ï¼Œæ²¡æœ‰å¯¹ \u003c è¿›è¡Œè½¬ä¹‰ã€‚å¯¼è‡´è¿™æ®µ JS åœ¨å…¶ä»–äººæ‰“å¼€æ­¤é¡µé¢çš„æ—¶å€™ä¹Ÿè¢«æ‰§è¡Œäº†ã€‚\nå¦‚æœæˆ‘ä¸Šé¢çš„ hack JS ä¸­å†™äº†è·å–æ‰€æœ‰ cookieï¼Œå¹¶å‘é€åˆ°æˆ‘çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯å°±æ³„æ¼äº†ã€‚\nå¦‚æœ cookie å¼€å¯äº† http-only ä¹‹åï¼Œæˆ‘çš„hack js æ— æ³•è·å–åˆ°ç”¨æˆ·çš„ cookieï¼Œå®ƒä»¬çš„ç™»å½•ä¿¡æ¯å°±æ— æ³•æ³„æ¼äº†ã€‚\nä»¥ Google ç¿»è¯‘ä¸ºä¾‹å­ï¼Œåˆæ¬¡æ‰“å¼€æ—¶ï¼ŒCookieé‡Œé¢æ˜¯è¿™æ ·çš„ä¸€å…±æœ‰4æ¡è®°å½•ï¼Œæ³¨æ„ç¬¬äºŒä¸ªæœ€å³ä¾§å€’æ•°ç¬¬ä¸‰ä¸ªå­—æ®µæœ‰ä¸€ä¸ªâˆšï¼Œ è¿™ä¸ªå¯¹å‹¾è¡¨æ˜è¿™æ¡è®°å½•æ˜¯ HttpOnly = true çš„ï¼Œå¯¹äºJsï¼Œä½ æ˜¯æ‹¿ä¸åˆ°çš„ã€‚\næœåŠ¡ç«¯è®¾ç½®Cookie\n1 2 3 4 5 6 7 8 9 10 @RequestMapping(\"/login\") @ResponseBody public void login(HttpServletRequest request, HttpServletResponse response) throws IOException { Cookie cookie = new Cookie(\"access_token\", UUID.randomUUID().toString()); cookie.setHttpOnly(true); // è¿™é‡Œ cookie.setPath(\"/\"); cookie.setDomain(\"localhost\"); response.addCookie(cookie); response.sendRedirect(\"http://localhost:8088/index.html\"); } xssæ”»å‡»å’Œcsrfæ”»å‡»é…åˆ ä¸€èˆ¬æ”»å‡»å¯èƒ½ä¸æ˜¯å•ä¸€çš„è¡Œä¸ºï¼Œè€Œæ˜¯å¯èƒ½ä¼šç»„åˆæ”»å‡»ï¼›æ¯”å¦‚xssæ”»å‡»ä¸€èˆ¬è¿˜å¯ä»¥é…åˆcsrfæ”»å‡»è¿›è¡Œé…åˆæ”»å‡»ï¼Œè¿™é‡Œç»™ä¸ªä¾‹å­ï¼Œæ–¹ä¾¿ä½ ç†è§£ï¼›æ³¨æ„ï¼Œåªæ˜¯ä»…ä»…æ–¹ä¾¿ä½ ç†è§£ï¼Œå®é™…ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚\nå‡è®¾ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹GETè¯·æ±‚æ–¹å¼è¿›è¡Œä¿®æ”¹å¯†ç ï¼Œè¿™æ˜¯å…¸å‹çš„csrfæ”»å‡»æ–¹å¼ï¼šå¼€å‘å®‰å…¨ - CSRF è¯¦è§£\n1 2 http://127.0.0.1/test/vulnerabilities/csrf/? password_new=123456\u0026password_conf=123456\u0026Change=Change é‚£ä¹ˆä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼xssæ”»å‡»æ·»åŠ è„šæœ¬\n1 2 \u003cscript type=\"text/javascript\" src=\"http://127.0.0.1/test/vulnerabilities/csrf/? password_new=123456\u0026password_conf=123456\u0026Change=Change#\"\u003e\u003c/script\u003e å‚è€ƒé“¾æ¥\nå¼€å‘å®‰å…¨ - XSS è¯¦è§£\n",
  "wordCount" : "4104",
  "inLanguage": "zh",
  "datePublished": "2023-06-14T22:37:33+08:00",
  "dateModified": "2023-06-14T22:37:33+08:00",
  "author":[{
    "@type": "Person",
    "name": "chance7bin"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chance7bin.github.io/posts/design/xss/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Binb's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chance7bin.github.io/" accesskey="h" title="Binb&#39;s Blog (Alt + H)">
                <img src="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg" alt="" aria-label="logo"
                    height="35">Binb&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chance7bin.github.io/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/" title="ğŸ  ä¸»é¡µ">
                    <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/archives/" title="â±ï¸ æ—¶é—´è½´">
                    <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/posts" title="ğŸ“š æ–‡ç« ">
                    <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/tags" title="ğŸ”– æ ‡ç­¾">
                    <span>ğŸ”– æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/chance7bin" title="GitHub">
                    <span>GitHub</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://chance7bin.github.io/">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://chance7bin.github.io/posts/">ğŸ“š æ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://chance7bin.github.io/posts/design/">ğŸ¨ ç³»ç»Ÿè®¾è®¡</a></div>
    <h1 class="post-title">
      xss
    </h1>
    <div class="post-meta">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">


<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-06-14
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>4104å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>9åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>chance7bin
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://chance7bin.github.io/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" style="color: var(--secondary)!important;">ç³»ç»Ÿè®¾è®¡</a>
                &nbsp;<a href="https://chance7bin.github.io/tags/%E5%AE%89%E5%85%A8/" style="color: var(--secondary)!important;">å®‰å…¨</a>
            </span>
        </span>
    </span>

    
</span>


      
      
      
      
      
      
      
          
          
          
              
              
              
              
          
      
    </div>
  </header>
   <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#xss-%e7%ae%80%e4%bb%8b" aria-label="XSS ç®€ä»‹">XSS ç®€ä»‹</a></li>
                    <li>
                        <a href="#xss-%e6%94%bb%e5%87%bb%e7%b1%bb%e5%9e%8b" aria-label="XSS æ”»å‡»ç±»å‹">XSS æ”»å‡»ç±»å‹</a><ul>
                            
                    <li>
                        <a href="#%e5%8f%8d%e5%b0%84%e5%9e%8bxss%e6%94%bb%e5%87%bb" aria-label="åå°„å‹xssæ”»å‡»">åå°„å‹xssæ”»å‡»</a></li>
                    <li>
                        <a href="#%e5%ad%98%e5%82%a8%e5%9e%8bxss%e6%94%bb%e5%87%bb" aria-label="å­˜å‚¨å‹xssæ”»å‡»">å­˜å‚¨å‹xssæ”»å‡»</a></li>
                    <li>
                        <a href="#dom%e5%9e%8bxss%e6%94%bb%e5%87%bb" aria-label="DOMå‹xssæ”»å‡»">DOMå‹xssæ”»å‡»</a></li></ul>
                    </li>
                    <li>
                        <a href="#xss-%e6%94%bb%e5%87%bb%e7%9a%84%e5%8d%b1%e5%ae%b3" aria-label="XSS æ”»å‡»çš„å±å®³">XSS æ”»å‡»çš„å±å®³</a></li>
                    <li>
                        <a href="#%e9%80%9a%e8%bf%87xss%e7%9b%97%e7%94%a8cookie%e5%8d%b1%e5%ae%b3%e6%98%af%e4%bb%80%e4%b9%88" aria-label="é€šè¿‡xssç›—ç”¨cookieå±å®³æ˜¯ä»€ä¹ˆï¼Ÿ">é€šè¿‡xssç›—ç”¨cookieå±å®³æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
                    <li>
                        <a href="#xss-%e6%94%bb%e5%87%bb%e7%9a%84%e9%98%b2%e5%be%a1" aria-label="XSS æ”»å‡»çš„é˜²å¾¡">XSS æ”»å‡»çš„é˜²å¾¡</a><ul>
                            
                    <li>
                        <a href="#%e9%aa%8c%e8%af%81%e8%be%93%e5%85%a5" aria-label="éªŒè¯è¾“å…¥">éªŒè¯è¾“å…¥</a></li>
                    <li>
                        <a href="#escapehtml" aria-label="escapeHTML">escapeHTML</a></li>
                    <li>
                        <a href="#http-only" aria-label="http-only">http-only</a></li></ul>
                    </li>
                    <li>
                        <a href="#xss%e6%94%bb%e5%87%bb%e5%92%8ccsrf%e6%94%bb%e5%87%bb%e9%85%8d%e5%90%88" aria-label="xssæ”»å‡»å’Œcsrfæ”»å‡»é…åˆ">xssæ”»å‡»å’Œcsrfæ”»å‡»é…åˆ</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><blockquote>
<p>XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p>
</blockquote>
<h2 id="xss-ç®€ä»‹">XSS ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#xss-ç®€ä»‹">#</a></h2>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå°±æ˜¯ç•™è¨€æ¿ã€‚æˆ‘ä»¬çŸ¥é“ç•™è¨€æ¿é€šå¸¸çš„ä»»åŠ¡å°±æ˜¯æŠŠç”¨æˆ·ç•™è¨€çš„å†…å®¹å±•ç¤ºå‡ºæ¥ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„ç•™è¨€éƒ½æ˜¯æ­£å¸¸çš„è¯­è¨€æ–‡å­—ï¼Œç•™è¨€æ¿æ˜¾ç¤ºçš„å†…å®¹ä¹Ÿå°±æ²¡æ¯›ç—…ã€‚ç„¶è€Œè¿™ä¸ªæ—¶å€™å¦‚æœæœ‰äººä¸æŒ‰å¥—è·¯å‡ºç‰Œï¼Œåœ¨ç•™è¨€å†…å®¹ä¸­ä¸¢è¿›å»ä¸€è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆç•™è¨€æ¿ç•Œé¢çš„ç½‘é¡µä»£ç å°±ä¼šå˜æˆå½¢å¦‚ä»¥ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Board</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;board&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;     </span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™é—®é¢˜å°±æ¥äº†ï¼Œå½“æµè§ˆå™¨è§£æåˆ°ç”¨æˆ·è¾“å…¥çš„ä»£ç é‚£ä¸€è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆå¾ˆæ˜¾ç„¶ï¼Œæµè§ˆå™¨å¹¶ä¸çŸ¥é“è¿™äº›ä»£ç æ”¹å˜äº†åŸæœ¬ç¨‹åºçš„æ„å›¾ï¼Œä¼šç…§åšå¼¹å‡ºä¸€ä¸ªä¿¡æ¯æ¡†ã€‚</p>
<p>æ—¢ç„¶èƒ½å¤Ÿæ‰§è¡Œè„šæœ¬ï¼Œé‚£ä¹ˆï¼Œè¿™äº›è„šæœ¬å®Œå…¨å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>é“¾æ¥åŠ«æŒ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç›—å–cookie</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;document.cookie&#34;</span><span class="p">);</span><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºæ”»å‡»è€…æ¥è¯´ï¼Œèƒ½å¤Ÿè®©å—å®³è€…æµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç çš„å”¯ä¸€æ–¹å¼ï¼Œå°±æ˜¯æŠŠä»£ç æ³¨å…¥åˆ°å—å®³è€…ä»ç½‘ç«™ä¸‹è½½çš„ç½‘é¡µä¸­, è¿™å°±æ˜¯xssæ”»å‡»ã€‚</p>
<h2 id="xss-æ”»å‡»ç±»å‹">XSS æ”»å‡»ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#xss-æ”»å‡»ç±»å‹">#</a></h2>
<blockquote>
<p>é€šå¸¸XSSæ”»å‡»åˆ†ä¸ºï¼š<code>åå°„å‹xssæ”»å‡»</code>, <code>å­˜å‚¨å‹xssæ”»å‡»</code> å’Œ <code>DOMå‹xssæ”»å‡»</code>ã€‚åŒæ—¶æ³¨æ„ä»¥ä¸‹ä¾‹å­åªæ˜¯ç®€å•çš„å‘ä½ è§£é‡Šè¿™ä¸‰ç§ç±»å‹çš„æ”»å‡»æ–¹å¼è€Œå·²ï¼Œå®é™…æƒ…å†µæ¯”è¿™ä¸ªå¤æ‚ï¼Œå…·ä½“å¯ä»¥å†ç»“åˆæœ€åä¸€èŠ‚æ·±å…¥ç†è§£ã€‚</p>
</blockquote>
<h3 id="åå°„å‹xssæ”»å‡»">åå°„å‹xssæ”»å‡»<a hidden class="anchor" aria-hidden="true" href="#åå°„å‹xssæ”»å‡»">#</a></h3>
<blockquote>
<p>åå°„å‹çš„æ”»å‡»éœ€è¦ç”¨æˆ·ä¸»åŠ¨çš„å»è®¿é—®å¸¦æ”»å‡»çš„é“¾æ¥ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡é‚®ä»¶æˆ–è€…çŸ­ä¿¡çš„å½¢å¼ï¼Œè¯±å¯¼å—å®³è€…ç‚¹å¼€é“¾æ¥ã€‚å¦‚æœæ”»å‡»è€…é…åˆçŸ­é“¾æ¥URLï¼Œæ”»å‡»æˆåŠŸçš„æ¦‚ç‡ä¼šæ›´é«˜ã€‚</p>
</blockquote>
<p>åœ¨ä¸€ä¸ªåå°„å‹XSSæ”»å‡»ä¸­ï¼Œæ¶æ„æ–‡æœ¬å±äºå—å®³è€…å‘é€ç»™ç½‘ç«™çš„è¯·æ±‚ä¸­çš„ä¸€éƒ¨åˆ†ã€‚éšåç½‘ç«™åˆæŠŠæ¶æ„æ–‡æœ¬åŒ…å«è¿›ç”¨äºå“åº”ç”¨æˆ·çš„è¿”å›é¡µé¢ä¸­ï¼Œå‘è¿˜ç»™ç”¨æˆ·ã€‚</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202307182340890.png" alt="img"  />
</p>
<p>1ã€ç”¨æˆ·è¯¯ç‚¹å¼€äº†å¸¦æ”»å‡»çš„url : <code>http://xxx?name=&lt;script&gt;alert('aaa')&lt;/script&gt;</code></p>
<p>2ã€ç½‘ç«™ç»™å—å®³è€…çš„è¿”å›ä¸­æ­£å¸¸çš„ç½‘é¡µ</p>
<p>3ã€ç”¨æˆ·çš„æµè§ˆå™¨æ”¶åˆ°æ–‡æœ¬åæ‰§è¡Œé¡µé¢åˆæ³•è„šæœ¬ï¼Œè¿™æ—¶å€™é¡µé¢æ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä¼šåœ¨ç½‘é¡µä¸­å¼¹çª—aaa</p>
<p>è¿™ç§æ”»å‡»æ–¹å¼å‘ç”Ÿåœ¨æˆ‘ä»¬åˆæ³•çš„jsæ‰§è¡Œä¸­ï¼ŒæœåŠ¡å™¨æ— æ³•æ£€æµ‹æˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦æœ‰æ”»å‡»çš„å±é™©</p>
<h3 id="å­˜å‚¨å‹xssæ”»å‡»">å­˜å‚¨å‹xssæ”»å‡»<a hidden class="anchor" aria-hidden="true" href="#å­˜å‚¨å‹xssæ”»å‡»">#</a></h3>
<blockquote>
<p>è¿™ç§æ”»å‡»æ–¹å¼æ¶æ„ä»£ç ä¼šè¢«å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–ç”¨æˆ·åœ¨æ­£å¸¸è®¿é—®çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæœ‰ä¼šè¢«æ”»å‡»ï¼Œå½±å“çš„èŒƒå›´æ¯”è¾ƒå¤§ã€‚</p>
</blockquote>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202307182340891.png" alt="img"  />
</p>
<p>1ã€æ”»å‡»è€…é€šè¿‡è¯„è®ºè¡¨å•æäº¤å°†<code>&lt;script&gt;alert(â€˜aaaâ€™)&lt;/script&gt;</code>æäº¤åˆ°ç½‘ç«™</p>
<p>2ã€ç½‘ç«™åç«¯å¯¹æäº¤çš„è¯„è®ºæ•°æ®ä¸åšä»»ä½•æ“ä½œï¼Œç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“ä¸­</p>
<p>3ã€å…¶ä»–ç”¨æˆ·è®¿é—®æ­£å¸¸è®¿é—®ç½‘ç«™ï¼Œå¹¶ä¸”éœ€è¦è¯·æ±‚ç½‘ç«™çš„è¯„è®ºæ•°æ®</p>
<p>4ã€ç½‘ç«™åç«¯ä¼šä»æ•°æ®åº“ä¸­å–å‡ºæ•°æ®ï¼Œç›´æ¥è¿”å›ç»™ç”¨æˆ·</p>
<p>5ã€ç”¨æˆ·å¾—åˆ°é¡µé¢åï¼Œç›´æ¥è¿è¡Œæ”»å‡»è€…æäº¤çš„ä»£ç <code>&lt;script&gt;alert(â€˜aaaâ€™)&lt;/script&gt;</code>ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½ä¼šåœ¨ç½‘é¡µä¸­å¼¹å‡ºaaaçš„å¼¹çª—</p>
<h3 id="domå‹xssæ”»å‡»">DOMå‹xssæ”»å‡»<a hidden class="anchor" aria-hidden="true" href="#domå‹xssæ”»å‡»">#</a></h3>
<blockquote>
<p>åŸºäºDOMçš„XSSæ”»å‡»æ˜¯åå°„å‹æ”»å‡»çš„å˜ç§ã€‚æœåŠ¡å™¨è¿”å›çš„é¡µé¢æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯æˆ‘ä»¬åœ¨é¡µé¢æ‰§è¡Œjsçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠæ”»å‡»ä»£ç æ¤å…¥åˆ°é¡µé¢ä¸­ã€‚</p>
</blockquote>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202307182340896.png" alt="img"  />
</p>
<p>1ã€ç”¨æˆ·è¯¯ç‚¹å¼€äº†å¸¦æ”»å‡»çš„url : <code>http://xxx?name=&lt;script&gt;alert('aaa')&lt;/script&gt;</code></p>
<p>2ã€ç½‘ç«™ç»™å—å®³è€…çš„è¿”å›ä¸­æ­£å¸¸çš„ç½‘é¡µ</p>
<p>3ã€ç”¨æˆ·çš„æµè§ˆå™¨æ”¶åˆ°æ–‡æœ¬åæ‰§è¡Œé¡µé¢åˆæ³•è„šæœ¬ï¼Œè¿™æ—¶å€™é¡µé¢æ¶æ„è„šæœ¬ä¼šè¢«æ‰§è¡Œï¼Œä¼šåœ¨ç½‘é¡µä¸­å¼¹çª—aaa</p>
<p>è¿™ç§æ”»å‡»æ–¹å¼å‘ç”Ÿåœ¨æˆ‘ä»¬åˆæ³•çš„jsæ‰§è¡Œä¸­ï¼ŒæœåŠ¡å™¨æ— æ³•æ£€æµ‹æˆ‘ä»¬çš„è¯·æ±‚æ˜¯å¦æœ‰æ”»å‡»çš„å±é™©</p>
<h2 id="xss-æ”»å‡»çš„å±å®³">XSS æ”»å‡»çš„å±å®³<a hidden class="anchor" aria-hidden="true" href="#xss-æ”»å‡»çš„å±å®³">#</a></h2>
<ul>
<li>é€šè¿‡document.cookieç›—å–cookie</li>
<li>ä½¿ç”¨jsæˆ–cssç ´åé¡µé¢æ­£å¸¸çš„ç»“æ„ä¸æ ·å¼</li>
<li>æµé‡åŠ«æŒï¼ˆé€šè¿‡è®¿é—®æŸæ®µå…·æœ‰window.location.hrefå®šä½åˆ°å…¶ä»–é¡µé¢ï¼‰</li>
<li>Dosæ”»å‡»ï¼šåˆ©ç”¨åˆç†çš„å®¢æˆ·ç«¯è¯·æ±‚æ¥å ç”¨è¿‡å¤šçš„æœåŠ¡å™¨èµ„æºï¼Œä»è€Œä½¿åˆæ³•ç”¨æˆ·æ— æ³•å¾—åˆ°æœåŠ¡å™¨å“åº”ã€‚</li>
<li>åˆ©ç”¨iframeã€frameã€XMLHttpRequestæˆ–ä¸Šè¿°Flashç­‰æ–¹å¼ï¼Œä»¥ï¼ˆè¢«æ”»å‡»ï¼‰ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œä¸€äº›ç®¡ç†åŠ¨ä½œï¼Œæˆ–æ‰§è¡Œä¸€äº›ä¸€èˆ¬çš„å¦‚å‘å¾®åšã€åŠ å¥½å‹ã€å‘ç§ä¿¡ç­‰æ“ä½œã€‚</li>
<li>åˆ©ç”¨å¯è¢«æ”»å‡»çš„åŸŸå—åˆ°å…¶ä»–åŸŸä¿¡ä»»çš„ç‰¹ç‚¹ï¼Œä»¥å—ä¿¡ä»»æ¥æºçš„èº«ä»½è¯·æ±‚ä¸€äº›å¹³æ—¶ä¸å…è®¸çš„æ“ä½œï¼Œå¦‚è¿›è¡Œä¸å½“çš„æŠ•ç¥¨æ´»åŠ¨ã€‚</li>
<li>DOSï¼ˆæ‹’ç»æœåŠ¡ï¼‰å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚</li>
<li>é’“é±¼æ”»å‡»ï¼Œé«˜çº§çš„é’“é±¼æŠ€å·§ã€‚</li>
<li>åŠ«æŒç”¨æˆ·Webè¡Œä¸ºï¼Œç”šè‡³è¿›ä¸€æ­¥æ¸—é€å†…ç½‘ã€‚</li>
<li>è •è™«å¼æŒ‚é©¬æ”»å‡»ã€åˆ·å¹¿å‘Šã€åˆ·æµé‡ã€ç ´åç½‘ä¸Šæ•°æ®</li>
</ul>
<h2 id="é€šè¿‡xssç›—ç”¨cookieå±å®³æ˜¯ä»€ä¹ˆ">é€šè¿‡xssç›—ç”¨cookieå±å®³æ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#é€šè¿‡xssç›—ç”¨cookieå±å®³æ˜¯ä»€ä¹ˆ">#</a></h2>
<blockquote>
<p>csrfæ”»å‡»å…¶å®æ˜¯ä¸èƒ½ç›—ç”¨cookieçš„ï¼Œå®ƒåªæ˜¯ä»¥å½“å‰çš„åä¹‰è¿›è¡Œæ¶æ„æ“ä½œï¼›è€Œxssæ”»å‡»æ˜¯å¯ä»¥ç›´æ¥ç›—ç”¨cookieã€‚</p>
</blockquote>
<p>é‚£ç›—ç”¨cookieçš„å±å®³æ˜¯ä»€ä¹ˆï¼Ÿæ¯”å¦‚æ‹¿åˆ°ç”¨æˆ·çš„cookieä¿¡æ¯ï¼Œç„¶åä¼ é€åˆ°æ”»å‡»è€…è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä»cookieä¸­æå–æ•æ„Ÿä¿¡æ¯ï¼Œæ‹¿åˆ°ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œæˆ–è€…æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹DOMåœ¨é¡µé¢ä¸Šæ’å…¥ä¸€ä¸ªå‡çš„ç™»é™†æ¡†ï¼Œä¹Ÿå¯ä»¥æŠŠè¡¨å•çš„<code>action</code>å±æ€§æŒ‡å‘ä»–è‡ªå·±çš„æœåŠ¡å™¨åœ°å€ï¼Œç„¶åæ¬ºéª—ç”¨æˆ·æäº¤è‡ªå·±çš„æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆcookieä¹Ÿæ˜¯è¦é˜²å¾¡çš„</p>
<h2 id="xss-æ”»å‡»çš„é˜²å¾¡">XSS æ”»å‡»çš„é˜²å¾¡<a hidden class="anchor" aria-hidden="true" href="#xss-æ”»å‡»çš„é˜²å¾¡">#</a></h2>
<p>XSSæ”»å‡»å…¶å®å°±æ˜¯ä»£ç çš„æ³¨å…¥ã€‚ç”¨æˆ·çš„è¾“å…¥è¢«ç¼–è¯‘æˆæ¶æ„çš„ç¨‹åºä»£ç ã€‚æ‰€ä»¥ï¼Œä¸ºäº†é˜²èŒƒè¿™ä¸€ç±»ä»£ç çš„æ³¨å…¥ï¼Œéœ€è¦ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„å®‰å…¨æ€§ã€‚å¯¹äºæ”»å‡»éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æªæ–½ï¼š</p>
<ul>
<li><strong>ç¼–ç ï¼Œå°±æ˜¯è½¬ä¹‰ç”¨æˆ·çš„è¾“å…¥ï¼ŒæŠŠç”¨æˆ·çš„è¾“å…¥è§£è¯»ä¸ºæ•°æ®è€Œä¸æ˜¯ä»£ç </strong></li>
<li><strong>æ ¡éªŒï¼Œå¯¹ç”¨æˆ·çš„è¾“å…¥åŠè¯·æ±‚éƒ½è¿›è¡Œè¿‡æ»¤æ£€æŸ¥ï¼Œå¦‚å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œè®¾ç½®è¾“å…¥åŸŸçš„åŒ¹é…è§„åˆ™ç­‰</strong>ã€‚</li>
</ul>
<p>å…·ä½“æ¯”å¦‚ï¼š</p>
<ul>
<li><strong>å¯¹äºéªŒè¯è¾“å…¥</strong>ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åœ¨<code>æœåŠ¡ç«¯éªŒè¯</code>ï¼Œä¹Ÿå¯ä»¥åœ¨<code>å®¢æˆ·ç«¯éªŒè¯</code></li>
<li><strong>å¯¹äºæŒä¹…æ€§å’Œåå°„å‹æ”»å‡»</strong>ï¼Œ<code>æœåŠ¡ç«¯éªŒè¯</code>æ˜¯å¿…é¡»çš„ï¼ŒæœåŠ¡ç«¯æ”¯æŒçš„ä»»ä½•è¯­è¨€éƒ½èƒ½å¤Ÿåšåˆ°</li>
<li><strong>å¯¹äºåŸºäºDOMçš„XSSæ”»å‡»</strong>ï¼ŒéªŒè¯è¾“å…¥åœ¨å®¢æˆ·ç«¯å¿…é¡»æ‰§è¡Œï¼Œå› ä¸ºä»æœåŠ¡ç«¯æ¥è¯´ï¼Œæ‰€æœ‰å‘å‡ºçš„é¡µé¢å†…å®¹æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯åœ¨å®¢æˆ·ç«¯jsä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ‰å‘ç”Ÿå¯æ”»å‡»</li>
<li>ä½†æ˜¯å¯¹äºå„ç§æ”»å‡»æ–¹å¼ï¼Œ<strong>æˆ‘ä»¬æœ€å¥½åšåˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½è¿›è¡Œå¤„ç†</strong>ã€‚</li>
</ul>
<p>å…¶å®ƒè¿˜æœ‰ä¸€äº›è¾…åŠ©æªæ–½ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><strong>å…¥å‚é•¿åº¦é™åˆ¶</strong>ï¼š é€šè¿‡ä»¥ä¸Šçš„æ¡ˆä¾‹æˆ‘ä»¬ä¸éš¾å‘ç°xssæ”»å‡»è¦èƒ½è¾¾æˆå¾€å¾€éœ€è¦è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤å¯¹äºä¸€äº›å¯ä»¥é¢„æœŸçš„è¾“å…¥å¯ä»¥é€šè¿‡é™åˆ¶é•¿åº¦å¼ºåˆ¶æˆªæ–­æ¥è¿›è¡Œé˜²å¾¡ã€‚</li>
<li>è®¾ç½®cookie <code>http-only</code>ä¸ºtrue</li>
</ul>
<h3 id="éªŒè¯è¾“å…¥">éªŒè¯è¾“å…¥<a hidden class="anchor" aria-hidden="true" href="#éªŒè¯è¾“å…¥">#</a></h3>
<p>è‡ªå®šä¹‰<code>@Xss</code>æ³¨è§£ï¼Œå°†å®šä¹‰çš„Xssæ³¨è§£æ”¾åœ¨å­—æ®µæˆ–è€…æ–¹æ³•çš„ä¸Šæ–¹</p>
<p><strong><code>@Xss</code>æ³¨è§£</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * è‡ªå®šä¹‰xssæ ¡éªŒæ³¨è§£
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author 7bin
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Target</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">CONSTRUCTOR</span><span class="o">,</span> <span class="n">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span> <span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="o">{</span> <span class="n">XssValidator</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nd">@interface</span> <span class="n">Xss</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="nf">message</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">default</span> <span class="s">&#34;ä¸å…è®¸ä»»ä½•è„šæœ¬è¿è¡Œ&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è‡ªå®šä¹‰æ ¡éªŒå™¨<code>XssValidator</code></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JAVA" data-lang="JAVA"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * è‡ªå®šä¹‰xssæ ¡éªŒæ³¨è§£å®ç°
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author 7bin
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XssValidator</span> <span class="kd">implements</span> <span class="n">ConstraintValidator</span><span class="o">&lt;</span><span class="n">Xss</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HTML_PATTERN</span> <span class="o">=</span> <span class="s">&#34;&lt;(\\S*?)[^&gt;]*&gt;.*?|&lt;.*? /&gt;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">ConstraintValidatorContext</span> <span class="n">constraintValidatorContext</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">value</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">!</span><span class="n">containsHtml</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">containsHtml</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Pattern</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">HTML_PATTERN</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Matcher</span> <span class="n">matcher</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="na">matches</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä½¿ç”¨è‡ªå®šä¹‰Xssæ³¨è§£</strong></p>
<p><strong>å®ä½“ç±»</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JAVA" data-lang="JAVA"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SysUser</span> <span class="kd">extends</span> <span class="n">BaseEntity</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">....</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Xss</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&#34;ç”¨æˆ·è´¦å·ä¸èƒ½åŒ…å«è„šæœ¬å­—ç¬¦&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&#34;ç”¨æˆ·è´¦å·ä¸èƒ½ä¸ºç©º&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Size</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">30</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;ç”¨æˆ·è´¦å·é•¿åº¦ä¸èƒ½è¶…è¿‡30ä¸ªå­—ç¬¦&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Controller</strong></p>
<p>åœ¨Controllerçš„æ–¹æ³•ä¸Šï¼Œç»™å‚æ•°SysUserç±»åŠ ä¸Š<code>@Validated</code>æ¥ä¿®é¥°ï¼Œè¿™æ ·æ ¡éªŒå°±å¯ä»¥ç”Ÿæ•ˆäº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JAVA" data-lang="JAVA"><span class="line"><span class="cl"><span class="nd">@PutMapping</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ApiResponse</span> <span class="nf">edit</span><span class="o">(</span><span class="nd">@Validated</span> <span class="nd">@RequestBody</span> <span class="n">SysUser</span> <span class="n">user</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="escapehtml">escapeHTML<a hidden class="anchor" aria-hidden="true" href="#escapehtml">#</a></h3>
<p>åœ¨æœåŠ¡ç«¯æ·»åŠ XSSçš„Filterï¼Œ<strong>ç”¨äºæ­£ç¡®å¤„ç†è½¬ä¹‰å­—ç¬¦ï¼Œäº§ç”Ÿæ­£ç¡®çš„Javaã€JavaScriptã€HTMLã€XMLå’ŒSQLä»£ç </strong></p>
<p><code>FilterConfig</code>ï¼šæ³¨å†ŒXSSè¿‡æ»¤å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterConfig</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${xss.excludes}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">excludes</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${xss.urlPatterns}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">urlPatterns</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@SuppressWarnings</span><span class="o">({</span> <span class="s">&#34;rawtypes&#34;</span><span class="o">,</span> <span class="s">&#34;unchecked&#34;</span> <span class="o">})</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;xss.enabled&#34;</span><span class="o">,</span> <span class="n">havingValue</span> <span class="o">=</span> <span class="s">&#34;true&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">FilterRegistrationBean</span> <span class="nf">xssFilterRegistration</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FilterRegistrationBean</span> <span class="n">registration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">setDispatcherTypes</span><span class="o">(</span><span class="n">DispatcherType</span><span class="o">.</span><span class="na">REQUEST</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">XssFilter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="n">urlPatterns</span><span class="o">,</span> <span class="s">&#34;,&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;xssFilter&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">FilterRegistrationBean</span><span class="o">.</span><span class="na">HIGHEST_PRECEDENCE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">initParameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">initParameters</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;excludes&#34;</span><span class="o">,</span> <span class="n">excludes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">setInitParameters</span><span class="o">(</span><span class="n">initParameters</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">registration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>XssFilter</code>ï¼šä½¿ç”¨è‡ªå®šä¹‰<code>XssHttpServletRequestWrapper</code>æ›¿æ¢é»˜è®¤çš„request</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * é˜²æ­¢XSSæ”»å‡»çš„è¿‡æ»¤å™¨
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author 7bin
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XssFilter</span> <span class="kd">implements</span> <span class="n">Filter</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ’é™¤é“¾æ¥
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">excludes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">tempExcludes</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">&#34;excludes&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">tempExcludes</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span><span class="o">[]</span> <span class="n">url</span> <span class="o">=</span> <span class="n">tempExcludes</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;,&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">url</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">url</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">excludes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">url</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">chain</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpServletRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">request</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpServletResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">)</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">handleExcludeURL</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">XssHttpServletRequestWrapper</span> <span class="n">xssRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XssHttpServletRequestWrapper</span><span class="o">((</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">xssRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">handleExcludeURL</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// GET DELETE ä¸è¿‡æ»¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">method</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">method</span><span class="o">)</span> <span class="o">||</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">method</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">excludes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>XssHttpServletRequestWrapper</code></p>
<p>xssè¿‡æ»¤ï¼ˆæ¸…é™¤æ‰€æœ‰HTMLæ ‡ç­¾ï¼Œä½†æ˜¯ä¸åˆ é™¤æ ‡ç­¾å†…çš„å†…å®¹ï¼‰ï¼š<code>json = EscapeUtil.clean(json).trim();</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * XSSè¿‡æ»¤å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author 7bin
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XssHttpServletRequestWrapper</span> <span class="kd">extends</span> <span class="n">HttpServletRequestWrapper</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param request
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">XssHttpServletRequestWrapper</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getParameterValues</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getParameterValues</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">values</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span><span class="o">[]</span> <span class="n">escapesValues</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// é˜²xssæ”»å‡»å’Œè¿‡æ»¤å‰åç©ºæ ¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">escapesValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">EscapeUtil</span><span class="o">.</span><span class="na">clean</span><span class="o">(</span><span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">trim</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">escapesValues</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getParameterValues</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ServletInputStream</span> <span class="nf">getInputStream</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// éjsonç±»å‹ï¼Œç›´æ¥è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">isJsonRequest</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ä¸ºç©ºï¼Œç›´æ¥è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="kd">super</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span> <span class="s">&#34;utf-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">json</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// xssè¿‡æ»¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">json</span> <span class="o">=</span> <span class="n">EscapeUtil</span><span class="o">.</span><span class="na">clean</span><span class="o">(</span><span class="n">json</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">byte</span><span class="o">[]</span> <span class="n">jsonBytes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">ByteArrayInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">jsonBytes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ServletInputStream</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isReady</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">available</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">jsonBytes</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setReadListener</span><span class="o">(</span><span class="n">ReadListener</span> <span class="n">readListener</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span>
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ˜¯å¦æ˜¯Jsonè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isJsonRequest</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">header</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="n">HttpHeaders</span><span class="o">.</span><span class="na">CONTENT_TYPE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">startsWithIgnoreCase</span><span class="o">(</span><span class="n">header</span><span class="o">,</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="http-only">http-only<a hidden class="anchor" aria-hidden="true" href="#http-only">#</a></h3>
<p>å¦‚æœæŸä¸€ä¸ªCookie é€‰é¡¹è¢«è®¾ç½®æˆ HttpOnly = true çš„è¯ï¼Œé‚£æ­¤Cookie åªèƒ½é€šè¿‡æœåŠ¡å™¨ç«¯ä¿®æ”¹ï¼ŒJS æ˜¯æ“ä½œä¸äº†çš„ï¼Œå¯¹äº document.cookie æ¥è¯´æ˜¯é€æ˜çš„ã€‚</p>
<p>http-only çš„åº”ç”¨åœºæ™¯æ˜¯é˜²æ­¢ XSS æ”»å‡»ã€‚</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong></p>
<p>ä¾‹å¦‚æˆ‘åœ¨è¯„è®ºåŒºå†™äº†ä¸€æ®µ hack JSï¼ŒæœåŠ¡ç«¯å› å­˜åœ¨ XSS æ¼æ´ï¼Œæ²¡æœ‰å¯¹ &lt; è¿›è¡Œè½¬ä¹‰ã€‚å¯¼è‡´è¿™æ®µ JS åœ¨å…¶ä»–äººæ‰“å¼€æ­¤é¡µé¢çš„æ—¶å€™ä¹Ÿè¢«æ‰§è¡Œäº†ã€‚</p>
<p>å¦‚æœæˆ‘ä¸Šé¢çš„ hack JS ä¸­å†™äº†è·å–æ‰€æœ‰ cookieï¼Œå¹¶å‘é€åˆ°æˆ‘çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯å°±æ³„æ¼äº†ã€‚</p>
<p>å¦‚æœ cookie å¼€å¯äº† http-only ä¹‹åï¼Œæˆ‘çš„hack js æ— æ³•è·å–åˆ°ç”¨æˆ·çš„ cookieï¼Œå®ƒä»¬çš„ç™»å½•ä¿¡æ¯å°±æ— æ³•æ³„æ¼äº†ã€‚</p>
<p>ä»¥ Google ç¿»è¯‘ä¸ºä¾‹å­ï¼Œåˆæ¬¡æ‰“å¼€æ—¶ï¼ŒCookieé‡Œé¢æ˜¯è¿™æ ·çš„ä¸€å…±æœ‰4æ¡è®°å½•ï¼Œæ³¨æ„ç¬¬äºŒä¸ªæœ€å³ä¾§å€’æ•°ç¬¬ä¸‰ä¸ªå­—æ®µæœ‰ä¸€ä¸ªâˆšï¼Œ è¿™ä¸ªå¯¹å‹¾è¡¨æ˜è¿™æ¡è®°å½•æ˜¯ HttpOnly = true çš„ï¼Œå¯¹äºJsï¼Œä½ æ˜¯æ‹¿ä¸åˆ°çš„ã€‚</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202307182340899.png" alt="image-20230614194452836"  />
</p>
<p><strong>æœåŠ¡ç«¯è®¾ç½®Cookie</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">&#34;access_token&#34;</span><span class="o">,</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookie</span><span class="o">.</span><span class="na">setHttpOnly</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// è¿™é‡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">cookie</span><span class="o">.</span><span class="na">setPath</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookie</span><span class="o">.</span><span class="na">setDomain</span><span class="o">(</span><span class="s">&#34;localhost&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;http://localhost:8088/index.html&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="xssæ”»å‡»å’Œcsrfæ”»å‡»é…åˆ">xssæ”»å‡»å’Œcsrfæ”»å‡»é…åˆ<a hidden class="anchor" aria-hidden="true" href="#xssæ”»å‡»å’Œcsrfæ”»å‡»é…åˆ">#</a></h2>
<blockquote>
<p>ä¸€èˆ¬æ”»å‡»å¯èƒ½ä¸æ˜¯å•ä¸€çš„è¡Œä¸ºï¼Œè€Œæ˜¯å¯èƒ½ä¼šç»„åˆæ”»å‡»ï¼›æ¯”å¦‚xssæ”»å‡»ä¸€èˆ¬è¿˜å¯ä»¥é…åˆcsrfæ”»å‡»è¿›è¡Œé…åˆæ”»å‡»ï¼Œè¿™é‡Œç»™ä¸ªä¾‹å­ï¼Œæ–¹ä¾¿ä½ ç†è§£ï¼›æ³¨æ„ï¼Œåªæ˜¯ä»…ä»…æ–¹ä¾¿ä½ ç†è§£ï¼Œå®é™…ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>
</blockquote>
<p>å‡è®¾ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹GETè¯·æ±‚æ–¹å¼è¿›è¡Œä¿®æ”¹å¯†ç ï¼Œè¿™æ˜¯å…¸å‹çš„csrfæ”»å‡»æ–¹å¼ï¼š<a href="">å¼€å‘å®‰å…¨ - CSRF è¯¦è§£</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">http</span><span class="o">:</span><span class="c1">//127.0.0.1/test/vulnerabilities/csrf/?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">password_new</span><span class="o">=</span><span class="mi">123456</span><span class="o">&amp;</span><span class="nx">password_conf</span><span class="o">=</span><span class="mi">123456</span><span class="o">&amp;</span><span class="nx">Change</span><span class="o">=</span><span class="nx">Change</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼xssæ”»å‡»æ·»åŠ è„šæœ¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;http://127.0.0.1/test/vulnerabilities/csrf/?
</span></span></span><span class="line"><span class="cl"><span class="s2">password_new=123456&amp;password_conf=123456&amp;Change=Change#&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å‚è€ƒé“¾æ¥</strong></p>
<blockquote>
<p><a href="https://www.pdai.tech/md/develop/security/dev-security-x-xss.html">å¼€å‘å®‰å…¨ - XSS è¯¦è§£</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://chance7bin.github.io/posts/map/java%E4%BD%BF%E7%94%A8geoserver%E5%8F%91%E5%B8%83%E5%9C%B0%E5%9B%BE%E6%9C%8D%E5%8A%A1/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Javaä½¿ç”¨Geoserverå‘å¸ƒåœ°å›¾æœåŠ¡</span>
  </a>
  <a class="next" href="https://chance7bin.github.io/posts/design/redis%E5%92%8Cmysql%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%AE%9E%E7%8E%B0/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>rediså’Œmysqlç¼“å­˜ä¸€è‡´æ€§å®ç°</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://chance7bin.github.io/">Binb&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
