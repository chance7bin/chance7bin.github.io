<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>实验1 熟悉实验环境 | Binb&#39;s Blog</title>
<meta name="keywords" content="操作系统, 实验">
<meta name="description" content="写在前面 该专栏主要是基于 哈工大操作系统实验 Hit-oslab 记录的实验过程与学习笔记 ✍ 实验地址 ➡ 操作系统原理与实践 哈工大操作系统实验 Hit-oslab 环境搭建指南 1. 主要平台">
<meta name="author" content="chance7bin">
<link rel="canonical" href="https://chance7bin.github.io/posts/basic/os-lab/%E5%AE%9E%E9%AA%8C1-%E7%86%9F%E6%82%89%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.be81eec981a615a87a88f121642d7eebde74d033438693944db2fd6b827284ff.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity=""
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="apple-touch-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="mask-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="实验1 熟悉实验环境" />
<meta property="og:description" content="写在前面 该专栏主要是基于 哈工大操作系统实验 Hit-oslab 记录的实验过程与学习笔记 ✍ 实验地址 ➡ 操作系统原理与实践 哈工大操作系统实验 Hit-oslab 环境搭建指南 1. 主要平台" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chance7bin.github.io/posts/basic/os-lab/%E5%AE%9E%E9%AA%8C1-%E7%86%9F%E6%82%89%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-17T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="实验1 熟悉实验环境"/>
<meta name="twitter:description" content="写在前面 该专栏主要是基于 哈工大操作系统实验 Hit-oslab 记录的实验过程与学习笔记 ✍ 实验地址 ➡ 操作系统原理与实践 哈工大操作系统实验 Hit-oslab 环境搭建指南 1. 主要平台"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "📚 文章",
      "item": "https://chance7bin.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📕 计算机基础",
      "item": "https://chance7bin.github.io/posts/basic/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "hit-oslab",
      "item": "https://chance7bin.github.io/posts/basic/os-lab/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "实验1 熟悉实验环境",
      "item": "https://chance7bin.github.io/posts/basic/os-lab/%E5%AE%9E%E9%AA%8C1-%E7%86%9F%E6%82%89%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "实验1 熟悉实验环境",
  "name": "实验1 熟悉实验环境",
  "description": "写在前面 该专栏主要是基于 哈工大操作系统实验 Hit-oslab 记录的实验过程与学习笔记 ✍ 实验地址 ➡ 操作系统原理与实践 哈工大操作系统实验 Hit-oslab 环境搭建指南 1. 主要平台",
  "keywords": [
    "操作系统", "实验"
  ],
  "articleBody": "写在前面 该专栏主要是基于 哈工大操作系统实验 Hit-oslab 记录的实验过程与学习笔记 ✍\n实验地址 ➡ 操作系统原理与实践\n哈工大操作系统实验 Hit-oslab 环境搭建指南\n1. 主要平台和工具介绍 本操作系统实验的硬件环境是 IA-32（x86） 架构的 PC 机（在实验楼的环境中就是右侧的窗口），主要软件环境是 Bochs + gcc + 你最喜欢的编辑器 / IDE + 你最喜欢的操作系统 + Linux 0.11 源代码。\n实验的基本流程是根据实验要求编写应用程序、修改 Linux 0.11 的源代码，用 gcc 编译后，在 Bochs 的虚拟环境中运行、调试目标代码。\n上述实验环境涉及到的软件都是免费且开源的，具有较强的可移植性，可以在多种计算机的多种操作系统上搭建。为方便实验者，我们在最常见的平台 Ubuntu（最流行的 GNU/Linux 发行版之一）——上制作了 hit-oslab 集成环境，它基本包含了实验所需的所有软件，安装过程非常简单，基本上是直接解压就可以使用。\n1.1 x86 模拟器 Bochs Bochs 是一个免费且开放源代码的 IA-32（x86）架构 PC 机模拟器。在它模拟出的环境中可以运行 Linux、DOS 和各种版本的 Windows 等多种操作系统。而 Bochs 本身具有很高的移植性，可以运行在多种软硬件平台之上，这也是我们选择它做为本书的指定模拟器的主要原因。\n如果您想拥抱自由的 Linux，那么 Bochs 几乎是您的不二选择。如果您想继续把自己绑定在 Windows 平台上，那么除了 Bochs，您还可以选用 VMware 或者 Microsoft Virtual PC。它们是最著名虚拟机软件，而且都可以免费使用。因为 Bochs 的是模拟器，其原理决定了它的运行效率会低于虚拟机。\n但对于本书所设计的实验来说，效率上的差别很不明显。而且，Bochs 有虚拟机无可比拟的调试操作系统的能力，所以我们更建议您选用 Bochs。hit-oslab 已经内置了 bochs，本实验后文假定的缺省环境也是 Bochs。\n关于 Bochs 的更详细的介绍请访问它的 主页 及 Bochs 使用手册。\n1.2 GCC 编译器 GCC 是和 Linux 一起成长起来的编译器。Linux 最初的版本就是由 GCC 编译的。现在 GCC 也是在自由软件领域应用最广泛的编译器。所以，我们也选择 GCC 做为本书实验的指定编译器。\n1.3 GDB 调试器 GDB 调试器是 GCC 编译器的兄弟。做为自由软件领域几乎是唯一的调试器，它秉承了 Unix 类操作系统的一贯风格，采用纯命令行操作，有点儿类似 dos 下的 debug。\n关于它的使用方法请看 GDB 使用手册。\n另外，可以学习实验楼的 《GDB 简明教程》，通过动手实验学习 Linux 上 GDB 调试 C 语言程序的基本技巧。\n1.4 Ubuntu (GNU/Linux) Ubuntu 也许不是目前最好用的 Linux 桌面发行版，但它一定是最流行的。主要特点是易用，非常的易用。现在，已经有越来越多的人开始用 Ubuntu 完全代替 Windows，享受更加自由、安全、守法的感觉。\nUbuntu 的主页是 http://www.ubuntu.com/ ，这里不仅可以免费下载到 iso 文件，甚至能免费申领 Ubuntu 的安装光盘。\n我们强烈建议您在 Ubuntu 下做实验。因为有些实验内容涉及到在自己改进的 Linux 0.11 下，运行自己编的应用程序。被改进的功能都是高版本 Linux 内核已经具有的，在其上确认自己编写的应用程序无误后，再用之测试自己改进的 Linux 0.11，可以更有信心些。\n2. 实验环境的工作模式 （1）准备环境 hit-oslab 实验环境简称 oslab，是一个压缩文件（hit-oslab-linux-20110823.tar.gz），这个文件已经下载到了 /home/teacher 目录和 /home/shiyanlou/oslab（大家一进入实验环境，就是点击左边的 terminal 打开终端以后，所在的目录就是 /home/shiyanlou，这是大家的主目录）下，大家可以使用下面的命令解压展开压缩包即可工作。\n推荐大家使用如下的命令解压到 /home/shiyanlou/oslab/ 中。\n1 2 3 4 5 6 7 8 9 10 # 进入到 oslab 所在的文件夹 $ cd /home/shiyanlou/oslab/ # 解压，并指定解压到 /home/shiyanlou/ # 这样的话，在 /home/shiyanlou/oslab/ 中就能找到解压后的所有文件 $ tar -zxvf hit-oslab-linux-20110823.tar.gz -C /home/shiyanlou/ # 查看是否解压成功 $ ls -al # 除了压缩包 hit-oslab-linux-20110823.tar.gz 之外，其他的就是压缩包中的内容 （2）文件结构 Image 文件 oslab 工作在一个宿主操作系统之上，我们使用的 Linux，在宿主操作系统之上完成对 Linux 0.11 的开发、修改和编译之后，在 linux-0.11 目录下会生产一个名为 Image 的文件，它就是编译之后的目标文件。\n该文件内已经包含引导和所有内核的二进制代码。如果拿来一张软盘，从它的 0 扇区开始，逐字节写入 Image 文件的内容，就可以用这张软盘启动一台真正的计算机，并进入 Linux 0.11 内核。在此后的实验过程中，Bochs就是做这项模拟工作的\noslab 采用 bochs 模拟器加载这个 Image 文件，模拟执行 Linux 0.11，这样省却了重新启动计算机的麻烦。\nbochs 目录 bochs 目录下是与 bochs 相关的执行文件、数据文件和配置文件。\nrun 脚本 run 是运行 bochs 的脚本命令。\n运行后 bochs 会自动在它的虚拟软驱 A 和虚拟硬盘上各挂载一个镜像文件，软驱上挂载是 linux-0.11/Image，硬盘上挂载的是 hdc-0.11.img。\n因为 bochs 配置文件中的设置是从软驱 A 启动，所以 Linux 0.11 会被自动加载。\n而 Linux 0.11 会驱动硬盘，并 mount 硬盘上的文件系统，也就是将 hdc-0.11.img 内镜像的文件系统挂载到 0.11 系统内的根目录 —— /。在 0.11 下访问文件系统，访问的就是 hdc-0.11.img 文件内虚拟的文件系统。\nhdc-0.11.img 文件 hdc-0.11.img 文件的格式是 Minix 文件系统的镜像。\nLinux 所有版本都支持这种格式的文件系统，所以可以直接在宿主 Linux 上通过 mount 命令访问此文件内的文件，达到宿主系统和 bochs 内运行的 Linux 0.11 之间交换文件的效果。\nWindows 下目前没有（或者是还没发现）直接访问 Minix 文件系统的办法，所以要借助于 fdb.img，这是一个 1.44M 软盘的镜像文件，内部是 FAT12 文件系统。将它挂载到 bochs 的软驱 B，就可以在 0.11 中访问它。而通过 filedisk 或者 WinImage，可以在 Windows 下访问它内部的文件。\nhdc-0.11.img 内包含有：\nBash shell； 一些基本的 Linux 命令、工具，比如 cp、rm、mv、tar； vi 编辑器； gcc 1.4 编译器，可用来编译标准 C 程序； as86 和 ld86； Linux 0.11 的源代码，可在 0.11 下编译，然后覆盖现有的二进制内核。 其他文件在后面用到的时候会进行单独讲解。\n3. 使用方法 开始使用之前的准备活动：把当前目录切换到 oslab 下，用 pwd 命令确认，用 ls -l 列目录内容。\n1 2 3 4 5 6 7 8 # 切换目录 $ cd /home/shiyanlou/oslab/ # 确认路径 $ pwd # 查看目录内容 $ ls -l 本实验的所有内容都在本目录或其下级目录内完成。\n3.1 编译内核 “编译内核” 比 “编写内核” 要简单得多。\n首先要进入 linux-0.11 目录，然后执行 make 命令：\n1 2 $ cd ./linux-0.11/ $ make all 因为 all 是最常用的参数，所以可以省略，只用 make，效果一样。\n在多处理器的系统上，可以用 -j 参数进行并行编译，加快速度。例如双 CPU 的系统可以：\n1 $ make -j 2 make 命令会显示很多很多的信息，你可以尽量去看懂，也可以装作没看见。只要最后几行中没有 “error” 就说明编译成功。\n最后生成的目标文件是一个软盘镜像文件—— linux-0.11/Image（下面的图中给出了详细的信息）。如果将此镜像文件写到一张 1.44MB 的软盘上，就可以启动一台真正的计算机。\nlinux-0.11 目录下是全部的源代码，很多实验内容都是要靠修改这些代码来完成。修改后需要重新编译内核，还是执行命令：make all。\nmake 命令会自动跳过未被修改的文件，链接时直接使用上次编译生成的目标文件，从而节约编译时间。但如果重新编译后，你的修改貌似没有生效，可以试试先 make clean ，再 make all（或者一行命令：make clean \u0026\u0026 make all。make clean 是删除上一次编译生成的所有中间文件和目标文件，确保是在全新的状态下编译整个工程。\n3.2 运行 在 Bochs 中运行最新编译好的内核很简单，在 oslab 目录下执行：\n1 2 3 4 5 6 # 注意是在上层目录 # 刚刚编译是在 oslab/linux-0.11/ 文件夹下 $ cd ~/oslab/ # 执行 run 脚本 $ ./run 如果出现 Bochs 的窗口，里面显示 linux 的引导过程，最后停止在 [/usr/root/]#，表示运行成功，如下图所示。\n图 1 用 Bochs 启动 Linux 0.11 以后的样子\n遇到的问题 执行./run的时候报如下错误\n解决方法：\nhttps://blog.csdn.net/qq_40758751/article/details/88707214\n3.3 调试 内核调试分为两种模式：汇编级调试和 C 语言级调试。\n（1）汇编级调试 汇编级调试需要执行命令：\n1 2 3 4 5 # 确认在 oslab 目录下 $ cd ~/oslab/ # 运行脚本前确定已经关闭刚刚运行的 Bochs $ ./dbg-asm 汇编级调试的启动之后 Bochs 是黑屏，这是正常的。\n可以用命令 help 来查看调试系统用的基本命令。更详细的信息请查阅 Bochs 使用手册。\n（2）C 语言级调试 C 语言级调试稍微复杂一些。首先执行如下命令：\n1 2 $ cd ~/oslab $ ./dbg-c 然后再打开一个终端窗口，执行：\n1 2 $ cd ~/oslab $ ./rungdb 注意：启动的顺序不能交换，否则 gdb 无法连接。\n出现下图所示的提示，才说明连接成功：\n新终端窗口中运行的是 GDB 调试器。关于 gdb 调试器请查阅 GDB 使用手册。\n遇到的问题 在执行./rungdb的时候报如下错误\n解决方法：\nhttps://blog.csdn.net/longintchar/article/details/79619465\n（思路一）\n3.4 文件交换 接下来讲解一下 Ubuntu 和 Linux 0.11 之间的文件交换如何启动。\n开始设置文件交换之前，务必关闭所有的 Bochs 进程。\n注意 1：不要在 0.11 内核运行的时候 mount 镜像文件，否则可能会损坏文件系统。同理，也不要在已经 mount 的时候运行 0.11 内核。\n注意 2：在关闭 Bochs 之前，需要先在 0.11 的命令行运行 “sync”，确保所有缓存数据都存盘后，再关闭 Bochs。\nhdc(OpenHarmony Device Connector)\noslab 下的 hdc-0.11-new.img 是 0.11 内核启动后的根文件系统镜像文件，相当于在 bochs 虚拟机里装载的硬盘。在 Ubuntu 上访问其内容的方法是：\n1 2 3 4 $ cd ~/oslab/ # 启动挂载脚本 $ sudo ./mount-hdc 大家使用 sudo 时，password 是 shiyanlou，也有可能不会提示输入密码。\n之后，hdc 目录下就是和 0.11 内核一模一样的文件系统了，可以读写任何文件（可能有些文件要用 sudo 才能访问）。\n1 2 3 4 5 # 进入挂载到 Ubuntu 上的目录 $ cd ~/oslab/hdc # 查看内容 $ ls -al 可以看到hdc里面多了一个最小的Linux目录，而且桌面也成功挂载了一个64MB的硬盘，这个硬盘就是hdc-0.11.img文件系统。\n读写完毕，不要忘了卸载这个文件系统：\n1 2 3 4 $ cd ~/oslab/ # 卸载 $ sudo umount hdc 经过 sudo ./mount-hdc 这样处理以后，我们可以在 Ubuntu 的 hdc 目录下创建一个 xxx.c 文件，然后利用 Ubuntu 上的编辑工具（如 gedit 等）实现对 xxx.c 文件的编辑工作，在编辑保存以后。\n执行 sudo umount hdc 后，再进入 Linux 0.11（即 run 启动 bochs 以后）就会看到这个 xxx.c（即如下图所示），这样就避免了在 Linux 0.11 上进行编辑 xxx.c 的麻烦，因为 Linux 0.11 作为一个很小的操作系统，其上的编辑工具只有 vi，使用起来非常不便。\n图 2 用 Ubuntu 和 Linux 0.11 完成文件交换以后再启动 Linux 0.11 以后\n另外在 Linux 0.11 上产生的文件，如后面实验中产生的 process.log 文件，可以按这种方式 “拿到” Ubuntu 下用 python 程序进行处理，当然这个 python 程序在 Linux 0.11 上显然是不好使的，因为 Linux 0.11 上搭建不了 python 解释环境。\n遇到的问题 实验说明中，并没有提及图2所示的xxx.c文件是在挂在hdc目录后，在”${OSLAB}/hdc/usr/root/”目录下创建的。我一开始直接到hdc文件夹的根目录下创建了文件，发现文件并没有加载进去。折腾了一会儿才定位到是这个问题。\n",
  "wordCount" : "4105",
  "inLanguage": "zh",
  "datePublished": "2022-05-17T00:00:00Z",
  "dateModified": "2022-05-17T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "chance7bin"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chance7bin.github.io/posts/basic/os-lab/%E5%AE%9E%E9%AA%8C1-%E7%86%9F%E6%82%89%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Binb's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chance7bin.github.io/" accesskey="h" title="Binb&#39;s Blog (Alt + H)">
                <img src="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg" alt="" aria-label="logo"
                    height="35">Binb&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chance7bin.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/" title="🏠 主页">
                    <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/archives/" title="⏱️ 时间轴">
                    <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/posts" title="📚 文章">
                    <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/tags" title="🔖 标签">
                    <span>🔖 标签</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/chance7bin" title="GitHub">
                    <span>GitHub</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://chance7bin.github.io/">🏠 主页</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/">📚 文章</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/basic/">📕 计算机基础</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/basic/os-lab/">hit-oslab</a></div>
    <h1 class="post-title">
      实验1 熟悉实验环境
    </h1>
    <div class="post-meta">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">


<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-05-17
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>4105字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>9分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>chance7bin
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://chance7bin.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="color: var(--secondary)!important;">操作系统</a>
                &nbsp;<a href="https://chance7bin.github.io/tags/%E5%AE%9E%E9%AA%8C/" style="color: var(--secondary)!important;">实验</a>
            </span>
        </span>
    </span>

    
</span>


      
      
      
      
      
      
      
          
          
          
              
              
              
              
          
      
    </div>
  </header>
   <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2" aria-label="写在前面">写在前面</a></li>
                    <li>
                        <a href="#1-%e4%b8%bb%e8%a6%81%e5%b9%b3%e5%8f%b0%e5%92%8c%e5%b7%a5%e5%85%b7%e4%bb%8b%e7%bb%8d" aria-label="1. 主要平台和工具介绍">1. 主要平台和工具介绍</a><ul>
                            
                    <li>
                        <a href="#11-x86-%e6%a8%a1%e6%8b%9f%e5%99%a8-bochs" aria-label="1.1 x86 模拟器 Bochs">1.1 x86 模拟器 Bochs</a></li>
                    <li>
                        <a href="#12-gcc-%e7%bc%96%e8%af%91%e5%99%a8" aria-label="1.2 GCC 编译器">1.2 GCC 编译器</a></li>
                    <li>
                        <a href="#13-gdb-%e8%b0%83%e8%af%95%e5%99%a8" aria-label="1.3 GDB 调试器">1.3 GDB 调试器</a></li>
                    <li>
                        <a href="#14-ubuntu-gnulinux" aria-label="1.4 Ubuntu (GNU/Linux)">1.4 Ubuntu (GNU/Linux)</a></li></ul>
                    </li>
                    <li>
                        <a href="#2-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f" aria-label="2. 实验环境的工作模式">2. 实验环境的工作模式</a><ul>
                            
                    <li>
                        <a href="#1%e5%87%86%e5%a4%87%e7%8e%af%e5%a2%83" aria-label="（1）准备环境">（1）准备环境</a></li>
                    <li>
                        <a href="#2%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84" aria-label="（2）文件结构">（2）文件结构</a></li></ul>
                    </li>
                    <li>
                        <a href="#3-%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95" aria-label="3. 使用方法">3. 使用方法</a><ul>
                            
                    <li>
                        <a href="#31-%e7%bc%96%e8%af%91%e5%86%85%e6%a0%b8" aria-label="3.1 编译内核">3.1 编译内核</a></li>
                    <li>
                        <a href="#32-%e8%bf%90%e8%a1%8c" aria-label="3.2 运行">3.2 运行</a><ul>
                            
                    <li>
                        <a href="#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98" aria-label="遇到的问题"><code>遇到的问题</code></a></li></ul>
                    </li>
                    <li>
                        <a href="#33-%e8%b0%83%e8%af%95" aria-label="3.3 调试">3.3 调试</a><ul>
                            
                    <li>
                        <a href="#1%e6%b1%87%e7%bc%96%e7%ba%a7%e8%b0%83%e8%af%95" aria-label="（1）汇编级调试">（1）汇编级调试</a></li>
                    <li>
                        <a href="#2c-%e8%af%ad%e8%a8%80%e7%ba%a7%e8%b0%83%e8%af%95" aria-label="（2）C 语言级调试">（2）C 语言级调试</a><ul>
                            
                    <li>
                        <a href="#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98-1" aria-label="遇到的问题"><code>遇到的问题</code></a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#34-%e6%96%87%e4%bb%b6%e4%ba%a4%e6%8d%a2" aria-label="3.4 文件交换">3.4 文件交换</a><ul>
                            
                    <li>
                        <a href="#%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98-2" aria-label="遇到的问题"><code>遇到的问题</code></a>
                    </li>
                </ul>
                </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h2 id="写在前面">写在前面<a hidden class="anchor" aria-hidden="true" href="#写在前面">#</a></h2>
<blockquote>
<p>该专栏主要是基于 <code>哈工大操作系统实验 Hit-oslab</code> 记录的实验过程与学习笔记 ✍</p>
<p>实验地址 ➡  <a href="https://www.lanqiao.cn/courses/115">操作系统原理与实践</a></p>
</blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/357593420">哈工大操作系统实验 Hit-oslab 环境搭建指南</a></p>
<h2 id="1-主要平台和工具介绍">1. 主要平台和工具介绍<a hidden class="anchor" aria-hidden="true" href="#1-主要平台和工具介绍">#</a></h2>
<p>本操作系统实验的硬件环境是 IA-32（x86） 架构的 PC 机（在实验楼的环境中就是右侧的窗口），主要软件环境是 Bochs + gcc + 你最喜欢的编辑器 / IDE + 你最喜欢的操作系统 + Linux 0.11 源代码。</p>
<p>实验的基本流程是根据实验要求编写应用程序、修改 Linux 0.11 的源代码，用 gcc 编译后，在 Bochs 的虚拟环境中运行、调试目标代码。</p>
<p>上述实验环境涉及到的软件都是免费且开源的，具有较强的可移植性，可以在多种计算机的多种操作系统上搭建。为方便实验者，我们在最常见的平台 Ubuntu（最流行的 GNU/Linux 发行版之一）——上制作了 hit-oslab 集成环境，它基本包含了实验所需的所有软件，安装过程非常简单，基本上是直接解压就可以使用。</p>
<h3 id="11-x86-模拟器-bochs">1.1 x86 模拟器 Bochs<a hidden class="anchor" aria-hidden="true" href="#11-x86-模拟器-bochs">#</a></h3>
<p>Bochs 是一个免费且开放源代码的 IA-32（x86）架构 PC 机模拟器。在它模拟出的环境中可以运行 Linux、DOS 和各种版本的 Windows 等多种操作系统。而 Bochs 本身具有很高的移植性，可以运行在多种软硬件平台之上，这也是我们选择它做为本书的指定模拟器的主要原因。</p>
<p>如果您想拥抱自由的 Linux，那么 Bochs 几乎是您的不二选择。如果您想继续把自己绑定在 Windows 平台上，那么除了 Bochs，您还可以选用 VMware 或者 Microsoft Virtual PC。它们是最著名虚拟机软件，而且都可以免费使用。因为 Bochs 的是模拟器，其原理决定了它的运行效率会低于虚拟机。</p>
<p>但对于本书所设计的实验来说，效率上的差别很不明显。而且，Bochs 有虚拟机无可比拟的调试操作系统的能力，所以我们更建议您选用 Bochs。hit-oslab 已经内置了 bochs，本实验后文假定的缺省环境也是 Bochs。</p>
<p>关于 Bochs 的更详细的介绍请访问它的 <a href="http://bochs.sourceforge.net/">主页</a> 及 Bochs 使用手册。</p>
<h3 id="12-gcc-编译器">1.2 GCC 编译器<a hidden class="anchor" aria-hidden="true" href="#12-gcc-编译器">#</a></h3>
<p>GCC 是和 Linux 一起成长起来的编译器。Linux 最初的版本就是由 GCC 编译的。现在 GCC 也是在自由软件领域应用最广泛的编译器。所以，我们也选择 GCC 做为本书实验的指定编译器。</p>
<h3 id="13-gdb-调试器">1.3 GDB 调试器<a hidden class="anchor" aria-hidden="true" href="#13-gdb-调试器">#</a></h3>
<p>GDB 调试器是 GCC 编译器的兄弟。做为自由软件领域几乎是唯一的调试器，它秉承了 Unix 类操作系统的一贯风格，采用纯命令行操作，有点儿类似 dos 下的 debug。</p>
<p>关于它的使用方法请看 GDB 使用手册。</p>
<p>另外，可以学习实验楼的 <a href="https://www.lanqiao.cn/courses/496">《GDB 简明教程》</a>，通过动手实验学习 Linux 上 GDB 调试 C 语言程序的基本技巧。</p>
<h3 id="14-ubuntu-gnulinux">1.4 Ubuntu (GNU/Linux)<a hidden class="anchor" aria-hidden="true" href="#14-ubuntu-gnulinux">#</a></h3>
<p>Ubuntu 也许不是目前最好用的 Linux 桌面发行版，但它一定是最流行的。主要特点是易用，非常的易用。现在，已经有越来越多的人开始用 Ubuntu 完全代替 Windows，享受更加自由、安全、守法的感觉。</p>
<p>Ubuntu 的主页是 <a href="http://www.ubuntu.com/">http://www.ubuntu.com/</a> ，这里不仅可以免费下载到 iso 文件，甚至能免费申领 Ubuntu 的安装光盘。</p>
<p>我们强烈建议您在 Ubuntu 下做实验。因为有些实验内容涉及到在自己改进的 Linux 0.11 下，运行自己编的应用程序。被改进的功能都是高版本 Linux 内核已经具有的，在其上确认自己编写的应用程序无误后，再用之测试自己改进的 Linux 0.11，可以更有信心些。</p>
<h2 id="2-实验环境的工作模式">2. 实验环境的工作模式<a hidden class="anchor" aria-hidden="true" href="#2-实验环境的工作模式">#</a></h2>
<h3 id="1准备环境">（1）准备环境<a hidden class="anchor" aria-hidden="true" href="#1准备环境">#</a></h3>
<p><code>hit-oslab</code> 实验环境简称 oslab，是一个压缩文件（hit-oslab-linux-20110823.tar.gz），这个文件已经下载到了 <strong>/home/teacher</strong> 目录和 <strong>/home/shiyanlou/oslab</strong>（大家一进入实验环境，就是点击左边的 terminal 打开终端以后，所在的目录就是 /home/shiyanlou，这是大家的主目录）下，大家可以使用下面的命令解压展开压缩包即可工作。</p>
<p>推荐大家使用如下的命令解压到 <code>/home/shiyanlou/oslab/</code> 中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 进入到 oslab 所在的文件夹</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/shiyanlou/oslab/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解压，并指定解压到 /home/shiyanlou/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 这样的话，在 /home/shiyanlou/oslab/ 中就能找到解压后的所有文件</span>
</span></span><span class="line"><span class="cl">$ tar -zxvf hit-oslab-linux-20110823.tar.gz -C /home/shiyanlou/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看是否解压成功</span>
</span></span><span class="line"><span class="cl">$ ls -al
</span></span><span class="line"><span class="cl"><span class="c1"># 除了压缩包 hit-oslab-linux-20110823.tar.gz 之外，其他的就是压缩包中的内容</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2文件结构">（2）文件结构<a hidden class="anchor" aria-hidden="true" href="#2文件结构">#</a></h3>
<ul>
<li>Image 文件</li>
</ul>
<p>oslab 工作在一个宿主操作系统之上，我们使用的 Linux，在宿主操作系统之上完成对 Linux 0.11 的开发、修改和编译之后，在 linux-0.11 目录下会生产一个名为 <strong>Image</strong> 的文件，它就是编译之后的目标文件。</p>
<p>该文件内已经包含引导和所有内核的二进制代码。如果拿来一张软盘，从它的 0 扇区开始，逐字节写入 Image 文件的内容，就可以用这张软盘启动一台真正的计算机，并进入 Linux 0.11 内核。<strong><code>在此后的实验过程中，Bochs就是做这项模拟工作的</code></strong></p>
<blockquote>
<p>oslab 采用 bochs 模拟器加载这个 Image 文件，模拟执行 Linux 0.11，这样省却了重新启动计算机的麻烦。</p>
</blockquote>
<ul>
<li>bochs 目录</li>
</ul>
<p>bochs 目录下是与 bochs 相关的执行文件、数据文件和配置文件。</p>
<ul>
<li>run 脚本</li>
</ul>
<p>run 是运行 bochs 的脚本命令。</p>
<p><strong>运行后 bochs 会自动在它的虚拟软驱 A 和虚拟硬盘上各挂载一个镜像文件，软驱上挂载是 linux-0.11/Image，硬盘上挂载的是 hdc-0.11.img。</strong></p>
<p>因为 bochs 配置文件中的设置是从软驱 A 启动，所以 Linux 0.11 会被自动加载。</p>
<p>而 Linux 0.11 会驱动硬盘，并 mount 硬盘上的文件系统，也就是将 hdc-0.11.img 内镜像的文件系统挂载到 0.11 系统内的根目录 —— <code>/</code>。在 0.11 下访问文件系统，访问的就是 hdc-0.11.img 文件内虚拟的文件系统。</p>
<ul>
<li>hdc-0.11.img 文件</li>
</ul>
<p>hdc-0.11.img 文件的格式是 Minix 文件系统的镜像。</p>
<p>Linux 所有版本都支持这种格式的文件系统，所以可以直接在宿主 Linux 上通过 mount 命令访问此文件内的文件，达到宿主系统和 bochs 内运行的 Linux 0.11 之间交换文件的效果。</p>
<p>Windows 下目前没有（或者是还没发现）直接访问 Minix 文件系统的办法，所以要借助于 fdb.img，这是一个 1.44M 软盘的镜像文件，内部是 FAT12 文件系统。将它挂载到 bochs 的软驱 B，就可以在 0.11 中访问它。而通过 filedisk 或者 WinImage，可以在 Windows 下访问它内部的文件。</p>
<p>hdc-0.11.img 内包含有：</p>
<ul>
<li>Bash shell；</li>
<li>一些基本的 Linux 命令、工具，比如 cp、rm、mv、tar；</li>
<li>vi 编辑器；</li>
<li>gcc 1.4 编译器，可用来编译标准 C 程序；</li>
<li>as86 和 ld86；</li>
<li>Linux 0.11 的源代码，可在 0.11 下编译，然后覆盖现有的二进制内核。</li>
</ul>
<blockquote>
<p>其他文件在后面用到的时候会进行单独讲解。</p>
</blockquote>
<h2 id="3-使用方法">3. 使用方法<a hidden class="anchor" aria-hidden="true" href="#3-使用方法">#</a></h2>
<p>开始使用之前的准备活动：把当前目录切换到 oslab 下，用 <code>pwd</code> 命令确认，用 <code>ls -l</code> 列目录内容。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 切换目录</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/shiyanlou/oslab/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 确认路径</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">pwd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看目录内容</span>
</span></span><span class="line"><span class="cl">$ ls -l
</span></span></code></pre></td></tr></table>
</div>
</div><p>本实验的所有内容都在本目录或其下级目录内完成。</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336540.png" alt="image-20220317155618148"  />
</p>
<h3 id="31-编译内核">3.1 编译内核<a hidden class="anchor" aria-hidden="true" href="#31-编译内核">#</a></h3>
<p>“编译内核” 比 “编写内核” 要简单得多。</p>
<p>首先要进入 linux-0.11 目录，然后执行 make 命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ cd ./linux-0.11/
</span></span><span class="line"><span class="cl">$ make all
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为 <code>all</code> 是最常用的参数，所以可以省略，只用 <code>make</code>，效果一样。</p>
<p>在多处理器的系统上，可以用 -j 参数进行并行编译，加快速度。例如双 CPU 的系统可以：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ make -j <span class="m">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>make 命令会显示很多很多的信息，你可以尽量去看懂，也可以装作没看见。只要最后几行中没有 “error” 就说明编译成功。</p>
<p>最后生成的目标文件是一个软盘镜像文件—— <code>linux-0.11/Image</code>（下面的图中给出了详细的信息）。如果将此镜像文件写到一张 1.44MB 的软盘上，就可以启动一台真正的计算机。</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336549.png" alt="image-20220317155732006"  />
</p>
<p>linux-0.11 目录下是全部的源代码，很多实验内容都是要靠修改这些代码来完成。修改后需要重新编译内核，还是执行命令：<code>make all</code>。</p>
<p>make 命令会自动跳过未被修改的文件，链接时直接使用上次编译生成的目标文件，从而节约编译时间。但如果重新编译后，你的修改貌似没有生效，可以试试先 <code>make clean</code> ，再 <code>make all</code>（或者一行命令：<code>make clean &amp;&amp; make all</code>。<code>make clean</code> 是删除上一次编译生成的所有中间文件和目标文件，确保是在全新的状态下编译整个工程。</p>
<h3 id="32-运行">3.2 运行<a hidden class="anchor" aria-hidden="true" href="#32-运行">#</a></h3>
<p>在 Bochs 中运行最新编译好的内核很简单，在 oslab 目录下执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 注意是在上层目录</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 刚刚编译是在 oslab/linux-0.11/ 文件夹下</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 执行 run 脚本</span>
</span></span><span class="line"><span class="cl">$ ./run
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果出现 Bochs 的窗口，里面显示 linux 的引导过程，最后停止在 <code>[/usr/root/]#</code>，表示运行成功，如下图所示。</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336556.png" alt="image-20220317155829493"  />
</p>
<p>图 1 用 Bochs 启动 Linux 0.11 以后的样子</p>
<h4 id="遇到的问题"><code>遇到的问题</code><a hidden class="anchor" aria-hidden="true" href="#遇到的问题">#</a></h4>
<p>执行<code>./run</code>的时候报如下错误</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336559.png" alt="image-20220317203131827"  />
</p>
<p>解决方法：</p>
<p><a href="https://blog.csdn.net/qq_40758751/article/details/88707214">https://blog.csdn.net/qq_40758751/article/details/88707214</a></p>
<h3 id="33-调试">3.3 调试<a hidden class="anchor" aria-hidden="true" href="#33-调试">#</a></h3>
<p>内核调试分为两种模式：汇编级调试和 C 语言级调试。</p>
<h4 id="1汇编级调试">（1）汇编级调试<a hidden class="anchor" aria-hidden="true" href="#1汇编级调试">#</a></h4>
<p>汇编级调试需要执行命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 确认在 oslab 目录下</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 运行脚本前确定已经关闭刚刚运行的 Bochs</span>
</span></span><span class="line"><span class="cl">$ ./dbg-asm
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>汇编级调试的启动之后 Bochs 是黑屏，这是正常的。</p>
</blockquote>
<p>可以用命令 <code>help</code> 来查看调试系统用的基本命令。更详细的信息请查阅 Bochs 使用手册。</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336562.png" alt="image-20220317155909228" style="zoom:80%;" /> 
<h4 id="2c-语言级调试">（2）C 语言级调试<a hidden class="anchor" aria-hidden="true" href="#2c-语言级调试">#</a></h4>
<p>C 语言级调试稍微复杂一些。首先执行如下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab
</span></span><span class="line"><span class="cl">$ ./dbg-c
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后再打开一个终端窗口，执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab
</span></span><span class="line"><span class="cl">$ ./rungdb
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意：启动的顺序不能交换，否则 gdb 无法连接。</p>
</blockquote>
<p>出现下图所示的提示，才说明连接成功：</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336574.png" alt="image-20220317155921182" style="zoom:80%;" /> 
<p>新终端窗口中运行的是 GDB 调试器。关于 gdb 调试器请查阅 GDB 使用手册。</p>
<h5 id="遇到的问题-1"><code>遇到的问题</code><a hidden class="anchor" aria-hidden="true" href="#遇到的问题-1">#</a></h5>
<p>在执行<code>./rungdb</code>的时候报如下错误</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336039.png" alt="image-20220317211135440"  />
</p>
<p>解决方法：</p>
<p><a href="https://blog.csdn.net/longintchar/article/details/79619465">https://blog.csdn.net/longintchar/article/details/79619465</a></p>
<p>（思路一）</p>
<h3 id="34-文件交换">3.4 文件交换<a hidden class="anchor" aria-hidden="true" href="#34-文件交换">#</a></h3>
<p>接下来讲解一下 Ubuntu 和 Linux 0.11 之间的文件交换如何启动。</p>
<blockquote>
<p>开始设置文件交换之前，务必关闭所有的 Bochs 进程。</p>
</blockquote>
<blockquote>
<p>注意 1：不要在 0.11 内核运行的时候 mount 镜像文件，否则可能会损坏文件系统。同理，也不要在已经 mount 的时候运行 0.11 内核。</p>
<p>注意 2：在关闭 Bochs 之前，需要先在 0.11 的命令行运行 “sync”，确保所有缓存数据都存盘后，再关闭 Bochs。</p>
</blockquote>
<p><strong>hdc(OpenHarmony Device Connector)</strong></p>
<p>oslab 下的 <code>hdc-0.11-new.img</code> 是 0.11 内核启动后的根文件系统镜像文件，相当于在 bochs 虚拟机里装载的硬盘。在 Ubuntu 上访问其内容的方法是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动挂载脚本</span>
</span></span><span class="line"><span class="cl">$ sudo ./mount-hdc
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>大家使用 sudo 时，password 是 <code>shiyanlou</code>，也有可能不会提示输入密码。</p>
</blockquote>
<p>之后，hdc 目录下就是和 0.11 内核一模一样的文件系统了，可以读写任何文件（可能有些文件要用 sudo 才能访问）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 进入挂载到 Ubuntu 上的目录</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab/hdc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看内容</span>
</span></span><span class="line"><span class="cl">$ ls -al
</span></span></code></pre></td></tr></table>
</div>
</div><img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336059.png" alt="image-20220317212510617" style="zoom:80%;" /> 
<p>可以看到hdc里面多了一个最小的Linux目录，而且桌面也成功挂载了一个64MB的硬盘，这个硬盘就是hdc-0.11.img文件系统。</p>
<p>读写完毕，不要忘了卸载这个文件系统：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/oslab/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 卸载</span>
</span></span><span class="line"><span class="cl">$ sudo umount hdc
</span></span></code></pre></td></tr></table>
</div>
</div><p>经过 <code>sudo ./mount-hdc</code> 这样处理以后，我们可以在 Ubuntu 的 hdc 目录下创建一个 xxx.c 文件，然后利用 Ubuntu 上的编辑工具（如 gedit 等）实现对 xxx.c 文件的编辑工作，在编辑保存以后。</p>
<p>执行 <code>sudo umount hdc</code> 后，再进入 Linux 0.11（即 run 启动 bochs 以后）就会看到这个 xxx.c（即如下图所示），这样就避免了在 Linux 0.11 上进行编辑 xxx.c 的麻烦，因为 Linux 0.11 作为一个很小的操作系统，其上的编辑工具只有 vi，使用起来非常不便。</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012336083.png" alt="image-20220317160007594" style="zoom:80%;" /> 
<p>图 2 用 Ubuntu 和 Linux 0.11 完成文件交换以后再启动 Linux 0.11 以后</p>
<p>另外在 Linux 0.11 上产生的文件，如后面实验中产生的 <code>process.log</code> 文件，可以按这种方式 “拿到” Ubuntu 下用 python 程序进行处理，当然这个 python 程序在 Linux 0.11 上显然是不好使的，因为 Linux 0.11 上搭建不了 python 解释环境。</p>
<blockquote>
</blockquote>
<h4 id="遇到的问题-2"><code>遇到的问题</code><a hidden class="anchor" aria-hidden="true" href="#遇到的问题-2">#</a></h4>
<p><strong>实验说明中，并没有提及图2所示的xxx.c文件是在挂在hdc目录后，在”${OSLAB}/hdc/usr/root/”目录下创建的。我一开始直接到hdc文件夹的根目录下创建了文件，发现文件并没有加载进去。折腾了一会儿才定位到是这个问题。</strong></p>


  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://chance7bin.github.io/posts/note/docker-%E5%AE%89%E8%A3%85-nominatim/">
    <span class="title">« 上一页</span>
    <br>
    <span>docker 安装 nominatim</span>
  </a>
  <a class="next" href="https://chance7bin.github.io/posts/basic/network/%E5%9B%BE%E8%A7%A3tcpip/">
    <span class="title">下一页 »</span>
    <br>
    <span>图解TCPIP</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://chance7bin.github.io/">Binb&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
