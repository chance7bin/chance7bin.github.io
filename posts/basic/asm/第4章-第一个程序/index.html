<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>第4章 第一个程序 | Binb&#39;s Blog</title>
<meta name="keywords" content="汇编">
<meta name="description" content="4.1 一个源程序从写出到执行的过程 4.2 源程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 assume cs: codesg codesg segment mov ax,0123H mov bx,0456H add ax,bx add ax,ax mov ax ,4c00H int 21H codesg ends end 伪指令 在汇编语言源程序中，包含两">
<meta name="author" content="chance7bin">
<link rel="canonical" href="https://chance7bin.github.io/posts/basic/asm/%E7%AC%AC4%E7%AB%A0-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.be81eec981a615a87a88f121642d7eebde74d033438693944db2fd6b827284ff.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity=""
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="apple-touch-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<link rel="mask-icon" href="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="第4章 第一个程序" />
<meta property="og:description" content="4.1 一个源程序从写出到执行的过程 4.2 源程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 assume cs: codesg codesg segment mov ax,0123H mov bx,0456H add ax,bx add ax,ax mov ax ,4c00H int 21H codesg ends end 伪指令 在汇编语言源程序中，包含两" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chance7bin.github.io/posts/basic/asm/%E7%AC%AC4%E7%AB%A0-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-04-13T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="第4章 第一个程序"/>
<meta name="twitter:description" content="4.1 一个源程序从写出到执行的过程 4.2 源程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 assume cs: codesg codesg segment mov ax,0123H mov bx,0456H add ax,bx add ax,ax mov ax ,4c00H int 21H codesg ends end 伪指令 在汇编语言源程序中，包含两"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "📚 文章",
      "item": "https://chance7bin.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📕 计算机基础",
      "item": "https://chance7bin.github.io/posts/basic/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "汇编语言",
      "item": "https://chance7bin.github.io/posts/basic/asm/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "第4章 第一个程序",
      "item": "https://chance7bin.github.io/posts/basic/asm/%E7%AC%AC4%E7%AB%A0-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "第4章 第一个程序",
  "name": "第4章 第一个程序",
  "description": "4.1 一个源程序从写出到执行的过程 4.2 源程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 assume cs: codesg codesg segment mov ax,0123H mov bx,0456H add ax,bx add ax,ax mov ax ,4c00H int 21H codesg ends end 伪指令 在汇编语言源程序中，包含两",
  "keywords": [
    "汇编"
  ],
  "articleBody": "4.1 一个源程序从写出到执行的过程 4.2 源程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 assume cs: codesg codesg segment mov ax,0123H mov bx,0456H add ax,bx add ax,ax mov ax ,4c00H int 21H codesg ends end 伪指令 在汇编语言源程序中，包含两种指令，一种是汇编指令，一种是伪指令。汇编指令是有对应的机器码的指令，可以被编译为机器指令，最终为CPU所执行。而伪指令没有对应的机器指令，最终不被CPU所执行。伪指令是由编译器来执行的指令，编译器根据伪指令来进行相关的编译工作。\n程序中出现了3种伪指令\n（1）segment和ends\nsegment和ends是一对成对使用的伪指令，这是在写可被编译器编译的汇编程序时，必须要用到的一对伪指\nsegment和ends的功能是定义一个段segment说明一个段开始，ends说明一个段结束。一个段必须有一个名称来标识\n（2）end\nend是一个汇编程序的结束标记，编译器在编译汇编程序的过程中，如果碰到了伪指令end，就结束对源程序的编译。所以，在我们写程序的时候，如果程序写完了，要在结尾处加上伪指令end。否则，编译器在编译程序时，无法知道程序在何处结束。\n（3) assume\n这条伪指令的含义为“假设”。它假设某一段寄存器和程序中的某一个用segment…ends定义的段相关联。通过 assume说明这种关联，在需要的情况下，编译程序可以将段寄存器和某一个具体的段相联系。\n比如，在程序中，用codesg segment … codesg ends定义了一个名为codseg的段，在这个段中存放代码，所以这个段是一个代码段。在程序的开头，用assume cs:codesg 将用作代码段的段codesg和CPU中的段寄存器cs联系起来。\n注意，以后可以将源程序文件中的所有内容称为源程序，将源程序中最终由计算机执行、处理的指令或数据，称为程序。\n程序返回 一个程序P2在可执行文件中，则必须有一个正在运行的程序P1，将P2从可执行文件中加载入内存后，将CPU的控制权交给P2，P2才能得以运行。P2开始运行后，P1暂停运行。而当P2运行完毕后，应该将CPU的控制权交还给使它得以运行的程序P1，此后，P1继续运行。\n现在，我们知道，一个程序结束后，将 CPU的控制权交还给使它得以运行的程序，我们称这个过程为：程序返回。那么，如何返回呢？应该在程序的末尾添加返回的程序段。\n我们回过头来，看一下程序中的两条指令：\n1 2 mov ax ,4c00H int 21H 这两条指令所实现的功能就是程序返回。\nDOS 源程序的编辑、编译、连接、执行 编辑 1 C:\\\u003eedit 编译 masm\n1 C:\\masm\u003emasm c:\\1; 在后面加分号自动忽略中间文件的生成\n连接 link\n1 C:\\masm\u003elink 1; 执行 1 C:\\masm\u003e1 4.8 谁将可执行文件中的程序装载进入内存并使它运行？ （1）在 DOS中直接执行1.exe时，是正在运行的command，将1.exe中的程序加载入内存;\n（2）command设置CPU 的CS:IP指向程序的第一条指令(即程序的入口)，从而使程序得以运行;\n（3）程序运行结束后，返回到command 中，CPU继续运行command。\n4.9 程序执行过程的跟踪 为了观察程序的运行过程，可以使用Debug。Debug 可以将程序加载入内存，设置CS:IP指向程序的入口，但 Debug 并不放弃对CPU的控制，这样，我们就可以使用Debug的相关命令来单步执行程序，查看每一条指令的执行结果。\n在 DOS系统中.EXE文件中的程序的加载过程 （1）程序加载后，ds中存放着程序所在内存区的段地址，这个内存区的偏移地址为0，则程序所在的内存区的地址为ds:0；\n（2）这个内存区的前256个字节中存放的是PSP，DOS用来和程序进行通信。从256字节处向后的空间存放的是程序。\n所以，从ds中可以得到PSP的段地址SA，PSP的偏移地址为0，则物理地址为SA×16+0。\n因为PSP占256(100H)字节，所以程序的物理地址是：SA×16+0+256=SA×16+16×16+0=(SA+16)×16+0\n可用段地址和偏移地址表示为：SA+10H:0。\n图4.19中DS 的值，DS=129E，则PSP的地址为129E:0，程序的地址为12AE:0(即129E+10:0)。\n==到了int 21，要用P命令执行==\nint 21执行后，显示出“Program terminated normally”，返回到 Debug中。表示程序正常结束。\n使用Q命令退出Debug，将返回到command 中，因为 Debug是由command加载运行的。在 DOS中用“debug 1.exe”运行Debug对1.exe进行跟踪时，程序加载的顺序是：command加载Debug，Debug加载1.exe。返回的顺序是：从 1.exe 中的程序返回到Debug，从Debug返回到command。\n==实验== 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 assume cs:codesg codesg segment mov ax,2000H mov ss,ax mov sp,0 add sp,10 pop ax pop bx push ax push bx pop ax pop bx mov ax,4c00H int 21H codesg ends end 2000:0 - 2000:f 这一行\n在执行pop时，红框内容右移\n在执行push时，红框内容左移 ==为什么？==\n",
  "wordCount" : "1954",
  "inLanguage": "zh",
  "datePublished": "2022-04-13T00:00:00Z",
  "dateModified": "2022-04-13T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "chance7bin"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chance7bin.github.io/posts/basic/asm/%E7%AC%AC4%E7%AB%A0-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Binb's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chance7bin.github.io/" accesskey="h" title="Binb&#39;s Blog (Alt + H)">
                <img src="https://chance7bin.github.io/img/%E7%BE%8E%E9%98%9F.jpg" alt="" aria-label="logo"
                    height="35">Binb&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chance7bin.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/" title="🏠 主页">
                    <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/archives/" title="⏱️ 时间轴">
                    <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/posts" title="📚 文章">
                    <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="https://chance7bin.github.io/tags" title="🔖 标签">
                    <span>🔖 标签</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/chance7bin" title="GitHub">
                    <span>GitHub</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://chance7bin.github.io/">🏠 主页</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/">📚 文章</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/basic/">📕 计算机基础</a>&nbsp;»&nbsp;<a href="https://chance7bin.github.io/posts/basic/asm/">汇编语言</a></div>
    <h1 class="post-title">
      第4章 第一个程序
    </h1>
    <div class="post-meta">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">


<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-04-13
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>1954字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>4分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>chance7bin
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://chance7bin.github.io/tags/%E6%B1%87%E7%BC%96/" style="color: var(--secondary)!important;">汇编</a>
            </span>
        </span>
    </span>

    
</span>


      
      
      
      
      
      
      
          
          
          
              
              
              
              
          
      
    </div>
  </header>
   <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#41-%e4%b8%80%e4%b8%aa%e6%ba%90%e7%a8%8b%e5%ba%8f%e4%bb%8e%e5%86%99%e5%87%ba%e5%88%b0%e6%89%a7%e8%a1%8c%e7%9a%84%e8%bf%87%e7%a8%8b" aria-label="4.1 一个源程序从写出到执行的过程">4.1 一个源程序从写出到执行的过程</a></li>
                    <li>
                        <a href="#42-%e6%ba%90%e7%a8%8b%e5%ba%8f" aria-label="4.2 源程序">4.2 源程序</a><ul>
                            
                    <li>
                        <a href="#%e4%bc%aa%e6%8c%87%e4%bb%a4" aria-label="伪指令">伪指令</a></li>
                    <li>
                        <a href="#%e7%a8%8b%e5%ba%8f%e8%bf%94%e5%9b%9e" aria-label="程序返回">程序返回</a></li></ul>
                    </li>
                    <li>
                        <a href="#dos-%e6%ba%90%e7%a8%8b%e5%ba%8f%e7%9a%84%e7%bc%96%e8%be%91%e7%bc%96%e8%af%91%e8%bf%9e%e6%8e%a5%e6%89%a7%e8%a1%8c" aria-label="DOS 源程序的编辑、编译、连接、执行">DOS 源程序的编辑、编译、连接、执行</a><ul>
                            
                    <li>
                        <a href="#%e7%bc%96%e8%be%91" aria-label="编辑">编辑</a></li>
                    <li>
                        <a href="#%e7%bc%96%e8%af%91" aria-label="编译">编译</a></li>
                    <li>
                        <a href="#%e8%bf%9e%e6%8e%a5" aria-label="连接">连接</a></li>
                    <li>
                        <a href="#%e6%89%a7%e8%a1%8c" aria-label="执行">执行</a></li></ul>
                    </li>
                    <li>
                        <a href="#48-%e8%b0%81%e5%b0%86%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6%e4%b8%ad%e7%9a%84%e7%a8%8b%e5%ba%8f%e8%a3%85%e8%bd%bd%e8%bf%9b%e5%85%a5%e5%86%85%e5%ad%98%e5%b9%b6%e4%bd%bf%e5%ae%83%e8%bf%90%e8%a1%8c" aria-label="4.8 谁将可执行文件中的程序装载进入内存并使它运行？">4.8 谁将可执行文件中的程序装载进入内存并使它运行？</a></li>
                    <li>
                        <a href="#49-%e7%a8%8b%e5%ba%8f%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b%e7%9a%84%e8%b7%9f%e8%b8%aa" aria-label="4.9 程序执行过程的跟踪">4.9 程序执行过程的跟踪</a><ul>
                            
                    <li>
                        <a href="#%e5%9c%a8-dos%e7%b3%bb%e7%bb%9f%e4%b8%adexe%e6%96%87%e4%bb%b6%e4%b8%ad%e7%9a%84%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%8a%a0%e8%bd%bd%e8%bf%87%e7%a8%8b" aria-label="在 DOS系统中.EXE文件中的程序的加载过程">在 DOS系统中.EXE文件中的程序的加载过程</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%ae%9e%e9%aa%8c" aria-label="==实验==">==实验==</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h3 id="41-一个源程序从写出到执行的过程">4.1 一个源程序从写出到执行的过程<a hidden class="anchor" aria-hidden="true" href="#41-一个源程序从写出到执行的过程">#</a></h3>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244574.png" alt="image-20211201110414049" style="zoom:80%;" /> 
<h3 id="42-源程序">4.2 源程序<a hidden class="anchor" aria-hidden="true" href="#42-源程序">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">assume cs: codesg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">codesg segment
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    mov ax,0123H
</span></span><span class="line"><span class="cl">    mov bx,0456H
</span></span><span class="line"><span class="cl">    add ax,bx
</span></span><span class="line"><span class="cl">    add ax,ax
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    mov ax ,4c00H
</span></span><span class="line"><span class="cl">    int 21H
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">codesg ends
</span></span><span class="line"><span class="cl">end
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="伪指令">伪指令<a hidden class="anchor" aria-hidden="true" href="#伪指令">#</a></h4>
<p>在汇编语言源程序中，包含两种指令，一种是汇编指令，一种是伪指令。汇编指令是有对应的机器码的指令，可以被编译为机器指令，最终为CPU所执行。而伪指令没有对应的机器指令，最终不被CPU所执行。伪指令是由编译器来执行的指令，编译器根据伪指令来进行相关的编译工作。</p>
<p>程序中出现了3种伪指令</p>
<p>（1）segment和ends</p>
<p>segment和ends是一对成对使用的伪指令，这是在写可被编译器编译的汇编程序时，必须要用到的一对伪指</p>
<p>segment和ends的功能是定义一个段segment说明一个段开始，ends说明一个段结束。一个段必须有一个名称来标识</p>
<p>（2）end</p>
<p>end是一个汇编程序的结束标记，编译器在编译汇编程序的过程中，如果碰到了伪指令end，就结束对源程序的编译。所以，在我们写程序的时候，如果程序写完了，要在结尾处加上伪指令end。否则，编译器在编译程序时，无法知道程序在何处结束。</p>
<p>（3) assume</p>
<p>这条伪指令的含义为“假设”。它假设某一段寄存器和程序中的某一个用segment&hellip;ends定义的段相关联。通过 assume说明这种关联，在需要的情况下，编译程序可以将段寄存器和某一个具体的段相联系。</p>
<p>比如，在程序中，用codesg segment &hellip; codesg ends定义了一个名为codseg的段，在这个段中存放代码，所以这个段是一个代码段。在程序的开头，用assume cs:codesg 将用作代码段的段codesg和CPU中的段寄存器cs联系起来。</p>
<p>注意，以后可以将源程序文件中的所有内容称为源程序，将源程序中最终由计算机执行、处理的指令或数据，称为程序。</p>
<h4 id="程序返回">程序返回<a hidden class="anchor" aria-hidden="true" href="#程序返回">#</a></h4>
<p>一个程序P2在可执行文件中，则必须有一个正在运行的程序P1，将P2从可执行文件中加载入内存后，将CPU的控制权交给P2，P2才能得以运行。P2开始运行后，P1暂停运行。而当P2运行完毕后，应该将CPU的控制权交还给使它得以运行的程序P1，此后，P1继续运行。</p>
<p>现在，我们知道，一个程序结束后，将 CPU的控制权交还给使它得以运行的程序，我们称这个过程为：<strong>程序返回</strong>。那么，如何返回呢？应该在程序的末尾添加返回的程序段。</p>
<p>我们回过头来，看一下程序中的两条指令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mov ax ,4c00H
</span></span><span class="line"><span class="cl">int 21H
</span></span></code></pre></td></tr></table>
</div>
</div><p>这两条指令所实现的功能就是程序返回。</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244594.png" alt="image-20211201111613700" style="zoom:80%;" /> 
<h3 id="dos-源程序的编辑编译连接执行">DOS 源程序的编辑、编译、连接、执行<a hidden class="anchor" aria-hidden="true" href="#dos-源程序的编辑编译连接执行">#</a></h3>
<h4 id="编辑">编辑<a hidden class="anchor" aria-hidden="true" href="#编辑">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt;edit
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="编译">编译<a hidden class="anchor" aria-hidden="true" href="#编译">#</a></h4>
<p>masm</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\masm&gt;masm c:\1;
</span></span></code></pre></td></tr></table>
</div>
</div><p>在后面加分号自动忽略中间文件的生成</p>
<h4 id="连接">连接<a hidden class="anchor" aria-hidden="true" href="#连接">#</a></h4>
<p>link</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\masm&gt;link 1;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="执行">执行<a hidden class="anchor" aria-hidden="true" href="#执行">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\masm&gt;1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="48-谁将可执行文件中的程序装载进入内存并使它运行">4.8 谁将可执行文件中的程序装载进入内存并使它运行？<a hidden class="anchor" aria-hidden="true" href="#48-谁将可执行文件中的程序装载进入内存并使它运行">#</a></h3>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244603.png" alt="image-20211201140731220"  />
</p>
<p>（1）在 DOS中直接执行1.exe时，是正在运行的command，将1.exe中的程序加载入内存;</p>
<p>（2）command设置CPU 的CS:IP指向程序的第一条指令(即程序的入口)，从而使程序得以运行;</p>
<p>（3）程序运行结束后，返回到command 中，CPU继续运行command。</p>
<p><img loading="lazy" src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244599.png" alt="image-20211201140834972"  />
</p>
<h3 id="49-程序执行过程的跟踪">4.9 程序执行过程的跟踪<a hidden class="anchor" aria-hidden="true" href="#49-程序执行过程的跟踪">#</a></h3>
<p>为了观察程序的运行过程，可以使用Debug。Debug 可以将程序加载入内存，设置CS:IP指向程序的入口，但 Debug 并不放弃对CPU的控制，这样，我们就可以使用Debug的相关命令来单步执行程序，查看每一条指令的执行结果。</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244597.png" alt="image-20211201141235919" style="zoom:80%;" /> 
<h4 id="在-dos系统中exe文件中的程序的加载过程">在 DOS系统中.EXE文件中的程序的加载过程<a hidden class="anchor" aria-hidden="true" href="#在-dos系统中exe文件中的程序的加载过程">#</a></h4>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244621.png" alt="image-20211201141311423" style="zoom:80%;" /> 
<p>（1）程序加载后，ds中存放着程序所在内存区的段地址，这个内存区的偏移地址为0，则程序所在的内存区的地址为ds:0；</p>
<p>（2）这个内存区的前256个字节中存放的是PSP，DOS用来和程序进行通信。从256字节处向后的空间存放的是程序。</p>
<p>所以，从ds中可以得到PSP的段地址SA，PSP的偏移地址为0，则物理地址为SA×16+0。</p>
<p>因为PSP占256(100H)字节，所以程序的物理地址是：SA×16+0+256=SA×16+16×16+0=(SA+16)×16+0</p>
<p>可用段地址和偏移地址表示为：SA+10H:0。</p>
<p>图4.19中DS 的值，DS=129E，则PSP的地址为129E:0，程序的地址为12AE:0(即129E+10:0)。</p>
<p>==到了int 21，要用P命令执行==</p>
<p>int 21执行后，显示出“Program terminated normally”，返回到 Debug中。表示程序正常结束。</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244012.png" alt="image-20211201141803738"  /> 
<p>使用Q命令退出Debug，将返回到command 中，因为 Debug是由command加载运行的。在 DOS中用“debug 1.exe”运行Debug对1.exe进行跟踪时，程序加载的顺序是：command加载Debug，Debug加载1.exe。返回的顺序是：从 1.exe 中的程序返回到Debug，从Debug返回到command。</p>
<h3 id="实验">==实验==<a hidden class="anchor" aria-hidden="true" href="#实验">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">assume cs:codesg
</span></span><span class="line"><span class="cl">codesg segment
</span></span><span class="line"><span class="cl">	mov ax,2000H
</span></span><span class="line"><span class="cl">	mov ss,ax
</span></span><span class="line"><span class="cl">	mov sp,0
</span></span><span class="line"><span class="cl">	add sp,10
</span></span><span class="line"><span class="cl">	pop ax
</span></span><span class="line"><span class="cl">	pop bx
</span></span><span class="line"><span class="cl">	push ax
</span></span><span class="line"><span class="cl">	push bx
</span></span><span class="line"><span class="cl">	pop ax
</span></span><span class="line"><span class="cl">	pop bx
</span></span><span class="line"><span class="cl">	mov ax,4c00H
</span></span><span class="line"><span class="cl">	int 21H
</span></span><span class="line"><span class="cl">codesg ends
</span></span><span class="line"><span class="cl">end
</span></span></code></pre></td></tr></table>
</div>
</div><p>2000:0 - 2000:f 这一行</p>
<p>在执行pop时，红框内容右移</p>
<p>在执行push时，红框内容左移 ==为什么？==</p>
<img src="https://blog-images-1301988137.cos.ap-nanjing.myqcloud.com/blog/2207/202308012244029.png" alt="image-20211201145316101" style="zoom:80%;" /> 


  </div>

  <footer class="post-footer">
    
<nav class="paginav">
  <a class="prev" href="https://chance7bin.github.io/posts/basic/os/%E4%BA%94%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/">
    <span class="title">« 上一页</span>
    <br>
    <span>五、存储管理</span>
  </a>
  <a class="next" href="https://chance7bin.github.io/posts/basic/os-lab/%E5%AE%9E%E9%AA%8C6-%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%92%8C%E5%BA%94%E7%94%A8/">
    <span class="title">下一页 »</span>
    <br>
    <span>实验6 信号量的实现和应用</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://chance7bin.github.io/">Binb&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
